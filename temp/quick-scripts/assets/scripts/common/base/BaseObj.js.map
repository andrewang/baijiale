{"version":3,"sources":["BaseObj.js"],"names":["cc","Class","extends","Component","properties","onLoad","uiContainer","bindUiNode","bindJs","node","onLoadCb","k","_components","v","__classname__","indexOf","js","recurBindUiNode","parentObj","_children","length","_name","obj","find","name","isCompoentJs","compoent","recurFind","parent","ret","getNameStringCount","str","limit","strLength","i","charCodeAt"],"mappings":"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","file":"BaseObj.js","sourceRoot":"../../../../../../assets/scripts/common/base","sourcesContent":["cc.Class({\n    extends: cc.Component,\n\n    properties: {\n\n    },\n\n    onLoad: function () {\n        this.uiContainer = {}\n        this.bindUiNode()\n        this.bindJs()\n        if (this.node.onLoadCb) {\n            this.node.onLoadCb(this)\n        }\n    },\n\n    //绑定脚本，绑定第一个组件类名不是cc.开头的组件。prefab.js引用脚本\n    bindJs: function () {\n        for (var k in this.node._components) {\n            var v = this.node._components[k]\n            if (-1 == v.__classname__.indexOf(\"cc\")) {\n                this.node.js = v\n                return\n            }\n        }\n    },\n\n    //绑定UI节点,可以通过this.节点名称访问UI编辑器上的节点。如果是在编辑器里生成的预制节点，则需要通过this.node访问。\n    bindUiNode: function () {\n        // cc.log(\"BaseObj:\", this)\n        // this.recurBindUiNode(this.node, this.uiContainer)\n        this.recurBindUiNode(this.node, this)\n    },\n\n    recurBindUiNode: function (node, parentObj) {\n        if (0 == node._children.length) {\n            //如果没有孩子且挂载的组件只有一个，则索引这个组件，可以通过._parent索引到这个组件挂载的节点上。\n            if (1 == node._components.length) {\n                parentObj[node._name] = node._components[0]\n            } else {\n                parentObj[node._name] = node\n            }\n        } else {\n            var obj\n            // if (\"Canvas\" == node._name || node._prefab) {\n            if (\"Canvas\" == node._name) {\n                obj = parentObj\n                for (var k in node._components) {\n                    // cc.log(\"zzzz\", k, node._components[k], node._components[k].__classname__)\n                }\n            } else {\n                // obj = parentObj[node._name] || {}\n                obj = parentObj[node._name] || node\n                parentObj[node._name] = obj\n            }\n            for (var k in node._children) {\n                var v = node._children[k]\n                this.recurBindUiNode(v, obj)\n            }\n        }\n    },\n\n    //找出节点，如果节点有且只有一个组件且没有孩子，则返回这个组件。注意这个函数返回的是creator框架本身的节点而不是上面绑定UI的节点的引用。\n    //如果节点有孩子，只挂载了一个组件，而且是脚本，则返回这个脚本。\n    find: function (name) {\n        // function recurFind(name, dict) {\n        //     for (var k in dict) {\n        //         if (name == k) {\n        //             return dict[k]\n        //         } else {\n        //             return recurFind(name, dict[k])\n        //         }\n        //     }\n        // }\n        // return recurFind(name, this.uiContainer)\n\n        // var ret = cc.find(name, this.node) //cc.find有BUG\n        // cc.log(\"???\", ret)\n        // if (1 == ret._components.length) {\n        //     return ret._components[0]\n        // } else {\n        //     return ret\n        // }\n\n        //组件是否JS脚本\n        function isCompoentJs(compoent) {\n            return -1 == compoent.__classname__.indexOf(\"cc\")\n        }\n\n        function recurFind(name, parent) {\n            if (!parent) {\n                return null\n            }\n            for (var k in parent._children) {\n                var v = parent._children[k]\n                if (name == v._name) {\n                    if (1 == v._components.length && 0 ==  v._children.length || (1 == v._components.length && isCompoentJs(v._components[0]))) {\n                        return v._components[0]\n                    } else {\n                        return v\n                    }\n                } else {\n                    var ret = recurFind(name, v)\n                    if (ret) {\n                        return ret\n                    }\n                }\n            }\n            return null\n        }\n        return recurFind(name, this.node)\n    },\n\n    getNameStringCount: function (str, limit) {\n        var strLength = 0\n        for (let i = 0; i < str.length; i++) {\n            if (str.charCodeAt(i) > 255) {\n                strLength += 2\n            }\n            else {\n                strLength++\n            }\n            if (limit && limit <= strLength) {\n                return i + 1\n            }\n        }\n        return strLength\n    },\n});\n"]}