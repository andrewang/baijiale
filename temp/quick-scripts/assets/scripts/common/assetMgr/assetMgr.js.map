{"version":3,"sources":["assetMgr.js"],"names":["BaseObj","require","cc","Class","extends","properties","_updating","manifestUrl","RawAsset","onLoad","sys","isNative","info","find","log","jsb","fileUtils","getWritablePath","_storagePath","versionCompareHandle","versionA","versionB","vA","split","vB","i","length","a","parseInt","b","_am","AssetsManager","ENABLE_GC_FOR_NATIVE_OBJECTS","retain","setVerifyCallback","path","asset","compressed","expectedMD5","md5","relativePath","size","checkCb","event","getEventCode","EventAssetsManager","ERROR_NO_LOCAL_MANIFEST","string","ERROR_DOWNLOAD_MANIFEST","ERROR_PARSE_MANIFEST","ALREADY_UP_TO_DATE","NEW_VERSION_FOUND","eventManager","removeListener","_checkListener","checkUpdate","getState","State","UNINITED","loadLocalManifest","getLocalManifest","isLoaded","EventListenerAssetsManager","bind","addListener","updateCb","needRestart","failed","UPDATE_PROGRESSION","getComponent","ProgressBar","progress","getPercent","getPercentByFile","getDownloadedFiles","getTotalFiles","getDownloadedBytes","getTotalBytes","msg","getMessage","UPDATE_FINISHED","UPDATE_FAILED","_canRetry","ERROR_UPDATING","getAssetId","ERROR_DECOMPRESS","_updateListener","searchPaths","getSearchPaths","newPaths","console","JSON","stringify","Array","prototype","unshift","localStorage","setItem","setSearchPaths","audioEngine","stopAll","game","restart","hotUpdate","_failCount","update","retry","downloadFailedAssets","onDestroy","release"],"mappings":"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","file":"assetMgr.js","sourceRoot":"../../../../../../assets/scripts/common/assetMgr","sourcesContent":["var BaseObj = require(\"BaseObj\")\ncc.Class({\n    // extends: cc.Component,\n    extends: BaseObj,\n\n    properties: {\n        _updating: false,\n        manifestUrl: cc.RawAsset,\n    },\n\n    // use this for initialization\n    onLoad: function () {\n        if (!cc.sys.isNative) {\n            return;\n        }\n        this.info = this.find(\"info\")\n        cc.log(\"3333444\", jsb.fileUtils.getWritablePath())\n        this._storagePath = ((jsb.fileUtils ? jsb.fileUtils.getWritablePath() : '/') + 'bjl-remote-asset');\n        cc.log('Storage path for remote asset : ' + this._storagePath);\n\n        this.versionCompareHandle = function (versionA, versionB) {\n            cc.log(\"JS Custom Version Compare: version A is \" + versionA + ', version B is ' + versionB);\n            var vA = versionA.split('.');\n            var vB = versionB.split('.');\n            for (var i = 0; i < vA.length; ++i) {\n                var a = parseInt(vA[i]);\n                var b = parseInt(vB[i] || 0);\n                if (a === b) {\n                    continue;\n                }\n                else {\n                    return a - b;\n                }\n            }\n            if (vB.length > vA.length) {\n                return -1;\n            }\n            else {\n                return 0;\n            }\n        };\n\n        this._am = new jsb.AssetsManager('', this._storagePath, this.versionCompareHandle);\n        if (!cc.sys.ENABLE_GC_FOR_NATIVE_OBJECTS) {\n            this._am.retain();\n        }\n\n        this._am.setVerifyCallback(function (path, asset) {\n            // When asset is compressed, we don't need to check its md5, because zip file have been deleted.\n            var compressed = asset.compressed;\n            // Retrieve the correct md5 value.\n            var expectedMD5 = asset.md5;\n            // asset.path is relative path and path is absolute.\n            var relativePath = asset.path;\n            // The size of asset file, but this value could be absent.\n            var size = asset.size;\n            if (compressed) {\n                cc.log(\"Verification passed : \" + relativePath);\n                return true;\n            }\n            else {\n                cc.log(\"Verification passed : \" + relativePath + ' (' + expectedMD5 + ')');\n                return true;\n            }\n        });\n    },\n\n    checkCb: function (event) {\n        cc.log('Code: ' + event.getEventCode());\n        switch (event.getEventCode()) {\n            case jsb.EventAssetsManager.ERROR_NO_LOCAL_MANIFEST:\n                this.info.string = \"No local manifest file found, hot update skipped.\";\n                break;\n            case jsb.EventAssetsManager.ERROR_DOWNLOAD_MANIFEST:\n            case jsb.EventAssetsManager.ERROR_PARSE_MANIFEST:\n                this.info.string = \"Fail to download manifest file, hot update skipped.\";\n                break;\n            case jsb.EventAssetsManager.ALREADY_UP_TO_DATE:\n                this.info.string = \"Already up to date with the latest remote version.\";\n                break;\n            case jsb.EventAssetsManager.NEW_VERSION_FOUND:\n                this.info.string = 'New version found, please try to update.';\n                // this.panel.checkBtn.active = false;\n                // this.panel.fileProgress.progress = 0;\n                // this.panel.byteProgress.progress = 0;\n                break;\n            default:\n                return;\n        }\n\n        cc.eventManager.removeListener(this._checkListener);\n        this._checkListener = null;\n        this._updating = false;\n    },\n\n    checkUpdate: function () {\n        if (this._updating) {\n            this.info.string = 'Checking or updating ...';\n            return;\n        }\n        if (this._am.getState() === jsb.AssetsManager.State.UNINITED) {\n            this._am.loadLocalManifest(this.manifestUrl);\n        }\n        if (!this._am.getLocalManifest() || !this._am.getLocalManifest().isLoaded()) {\n            this.info.string = 'Failed to load local manifest ...';\n            return;\n        }\n        this._checkListener = new jsb.EventListenerAssetsManager(this._am, this.checkCb.bind(this));\n        cc.eventManager.addListener(this._checkListener, 1);\n\n        this._am.checkUpdate();\n        this._updating = true;\n    },\n\n    // loadCustomManifest: function () {\n    //     if (this._am.getState() === jsb.AssetsManager.State.UNINITED) {\n    //         var manifest = new jsb.Manifest(customManifestStr, this._storagePath);\n    //         this._am.loadLocalManifest(manifest, this._storagePath);\n    //         // this.panel.info.string = 'Using custom manifest';\n    //     }\n    // },\n\n    updateCb: function (event) {\n        var needRestart = false;\n        var failed = false;\n        switch (event.getEventCode()) {\n            case jsb.EventAssetsManager.ERROR_NO_LOCAL_MANIFEST:\n                this.info.string = 'No local manifest file found, hot update skipped.';\n                failed = true;\n                break;\n            case jsb.EventAssetsManager.UPDATE_PROGRESSION:\n                // this.panel.byteProgress.progress = event.getPercent();\n                // this.panel.fileProgress.progress = event.getPercentByFile();\n                this.find(\"pbFile\").getComponent(cc.ProgressBar).progress = event.getPercent();\n                this.find(\"pbByte\").getComponent(cc.ProgressBar).progress = event.getPercentByFile();\n\n\n                // this.panel.fileLabel.string = event.getDownloadedFiles() + ' / ' + event.getTotalFiles();\n                // this.panel.byteLabel.string = event.getDownloadedBytes() + ' / ' + event.getTotalBytes();\n                this.find(\"fileDetail\").string = event.getDownloadedFiles() + ' / ' + event.getTotalFiles();\n                this.find(\"byteDetail\").string = event.getDownloadedBytes() + ' / ' + event.getTotalBytes();\n                // cc.log(event.getDownloadedBytes() + ' / ' + event.getTotalBytes())\n\n                var msg = event.getMessage();\n                if (msg) {\n                    // this.panel.info.string = 'Updated file: ' + msg;\n                    this.info.string = 'Updated file: ' + msg;\n                }\n                break;\n            case jsb.EventAssetsManager.ERROR_DOWNLOAD_MANIFEST:\n            case jsb.EventAssetsManager.ERROR_PARSE_MANIFEST:\n                this.info.string = 'Fail to download manifest file, hot update skipped222.';\n                failed = true;\n                break;\n            case jsb.EventAssetsManager.ALREADY_UP_TO_DATE:\n                this.info.string = 'Already up to date with the latest remote version.';\n                failed = true;\n                break;\n            case jsb.EventAssetsManager.UPDATE_FINISHED:\n                this.info.string = 'Update finished. ' + event.getMessage();\n                needRestart = true;\n                break;\n            case jsb.EventAssetsManager.UPDATE_FAILED:\n                this.info.string = 'Update failed. ' + event.getMessage();\n                // this.panel.retryBtn.active = true;\n                this._updating = false;\n                this._canRetry = true;\n                break;\n            case jsb.EventAssetsManager.ERROR_UPDATING:\n                this.info.string = 'Asset update error: ' + event.getAssetId() + ', ' + event.getMessage();\n                break;\n            case jsb.EventAssetsManager.ERROR_DECOMPRESS:\n                this.info.string = event.getMessage();\n                break;\n            default:\n                break;\n        }\n\n        if (failed) {\n            cc.eventManager.removeListener(this._updateListener);\n            this._updateListener = null;\n            this._updating = false;\n        }\n\n        if (needRestart) {\n            cc.eventManager.removeListener(this._updateListener);\n            this._updateListener = null;\n            var searchPaths = jsb.fileUtils.getSearchPaths();\n            var newPaths = this._am.getLocalManifest().getSearchPaths();\n            console.log(JSON.stringify(newPaths));\n            Array.prototype.unshift(searchPaths, newPaths);\n            cc.sys.localStorage.setItem('HotUpdateSearchPaths', JSON.stringify(searchPaths));\n            jsb.fileUtils.setSearchPaths(searchPaths);\n\n            cc.audioEngine.stopAll();\n            cc.game.restart();\n        }\n    },\n\n    hotUpdate: function () {\n        if (this._am && !this._updating) {\n            this._updateListener = new jsb.EventListenerAssetsManager(this._am, this.updateCb.bind(this));\n            cc.eventManager.addListener(this._updateListener, 1);\n\n            if (this._am.getState() === jsb.AssetsManager.State.UNINITED) {\n                this._am.loadLocalManifest(this.manifestUrl);\n            }\n\n            this._failCount = 0;\n            this._am.update();\n            // this.panel.updateBtn.active = false;\n            this._updating = true;\n        }\n    },\n\n    retry: function () {\n        if (!this._updating && this._canRetry) {\n            // this.panel.retryBtn.active = false;\n            this._canRetry = false;\n            \n            this.info.string = 'Retry failed Assets...';\n            this._am.downloadFailedAssets();\n        }\n    },\n\n    onDestroy: function () {\n        if (this._updateListener) {\n            cc.eventManager.removeListener(this._updateListener);\n            this._updateListener = null;\n        }\n        if (this._am && !cc.sys.ENABLE_GC_FOR_NATIVE_OBJECTS) {\n            this._am.release();\n        }\n    },\n\n});\n"]}