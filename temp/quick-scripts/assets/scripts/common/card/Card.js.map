{"version":3,"sources":["Card.js"],"names":["BaseObj","require","serverIndex","roleIndex","cardState","begin","dealMove","moveToJi","isJi","backToNormal","end","onFlipAct","zorder","init","onDeal","normal","onCompare","onJi","getScaleParam","scaleNum","cc","gameMgr","curJipaiPlayerUid","_myData","user_base_info","uid","scale1","scale2","scale3","Class","extends","properties","isCanSend","isCanSendJiPaiRequest","onLoad","_super","initListener","i","find","cardNode","firstSqueezeNode","offset","touchNode","node","oldPos","clone","position","size","_contentSize","on","Node","EventType","TOUCH_START","touch","showFirstSquezze","beginPos","parent","convertTouchToNodeSpaceAR","x","y","TOUCH_MOVE","pos","index","data","netMgr","request","ret","exec","setTimeout","bind","Math","abs","width","height","requestSqueeze","TOUCH_END","state","reset","num","type","setSqueeze","showNum","getComponent","Animation","stop","active","stopAllActions","setScale","setLocalZOrder","setData","cardData","cards","resMgr","updateSprite","getCardResName","getCardBackName","getNumRes","showTianPaiEffect","tianpaiStage","play","getTianPaiEffectPlayTime","time","duration","log","showYingPaiEffect","showBack","showFront","flip","squeezeComplete","cb1","callFunc","cb2","act1","sequence","scaleTo","act2","seq","runAction","isOnFlip","isNeedJi","isShow","isFront","isSquezze","callback","moveTo","cb","spawn","rotateTo","move","moveToSqueeze","cbFunc","setRotation","getJiPaiResName","isBack","getSqueezeType","squeezeType","threeD","scale","isWrite","sys","localStorage","getItem","threeDNode","threeDCardJs","addComponent","front","back","cardJs","setContentSize","getSize","actionTo","bBuPai","setItem","rotation","rotateAngle","releaseGL","destroy","view","showScore","musicMgr","playEffect","checkFlip","checkDelaySqueeze","round","delayTime","compare","cardList","bool","getIndex","getCardNum","getCardType","getCardOwner","zhuangList","xianList","indexOf","isFirst"],"mappings":"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","file":"Card.js","sourceRoot":"../../../../../../assets/scripts/common/card","sourcesContent":["var BaseObj = require(\"BaseObj\")\nvar serverIndex = {}\nserverIndex[1] = 1\nserverIndex[2] = 2\nserverIndex[3] = 1\nserverIndex[4] = 2\nserverIndex[5] = 3\nserverIndex[6] = 3\n\nvar roleIndex = {}\nroleIndex[1] = 2\nroleIndex[2] = 2\nroleIndex[3] = 1\nroleIndex[4] = 1\nroleIndex[5] = 2\nroleIndex[6] = 1\n\nvar cardState = {\n    begin: 0,\n    dealMove: 1, //发牌移动\n    moveToJi: 2, //移动到挤牌的地方\n    isJi: 3,     //正在挤牌\n    backToNormal: 4, //挤牌完移动到正常位置\n    end: 5,\n    onFlipAct: 6, //在翻转的动作中\n}\n\nvar zorder = {\n    init: 10,\n    onDeal: 40, //发牌的时候\n    normal: 30, //一般情况\n    onCompare: 60, //比牌\n    onJi: 100, //挤牌\n}\n\nvar getScaleParam = function (scaleNum) {\n    if (cc.gameMgr.curJipaiPlayerUid == cc.gameMgr._myData.user_base_info.uid) {\n        var scale1 = 3.0\n        var scale2 = 1\n        var scale3 = 0.35\n        if (1 == scaleNum) {\n            return scale1\n        }\n        else if (2 == scaleNum) {\n            return scale2\n        }\n        else if (3 == scaleNum) {\n            return scale3\n        }\n    } else {\n        var scale1 = 1\n        var scale2 = 0.35\n        var scale3 = 0.35\n        if (1 == scaleNum) {\n            return scale1\n        }\n        else if (2 == scaleNum) {\n            return scale2\n        }\n        else if (3 == scaleNum) {\n            return scale3\n        }\n    }\n}\n\ncc.Class({\n    extends: BaseObj,\n\n    properties: {\n        //1~13\n        // num: 0,\n        // //黑桃1，红桃2，梅花3，方块4\n        // type: 0,\n        // //客户端牌的索引 闲家125 庄家346\n        // index: 0,\n        //判断是否能发挤牌位置同步的协议\n        isCanSend: true,\n        //是否能发请求挤牌，因为挤牌的过程中触摸判断会导致发送多次，这里控制只发一次\n        isCanSendJiPaiRequest: true,\n    },\n\n    // use this for initialization\n    onLoad: function () {\n        this._super()\n\n        // this.threeDNode = this.find(\"threeDNode\")\n        // this.reset()\n        this.initListener()\n\n        for (var i = 1; i <= 6; i++) {\n            this[\"tianpai\" + i] = this.find(\"tianpai\" + i)\n\n            this[\"YingPai\" + i] = this.find(\"YingPai\" + i)\n        }\n        this.cardNode = this.find(\"cardNode\")\n        this.firstSqueezeNode = this.find(\"firstSqueezeNode\")\n    },\n\n    initListener: function () {\n        var offset\n        var touchNode = this.find(\"cardMove\").node\n        var oldPos = clone(touchNode.position)\n        var size = touchNode._contentSize\n        touchNode.on(cc.Node.EventType.TOUCH_START, function (touch) {\n            this.showFirstSquezze(false)\n            var beginPos = touchNode.parent.convertTouchToNodeSpaceAR(touch)\n            offset = { x: beginPos.x - touchNode.position.x, y: beginPos.y - touchNode.position.y }\n        }, this);\n        touchNode.on(cc.Node.EventType.TOUCH_MOVE, function (touch) {\n            if (cc.gameMgr.curJipaiPlayerUid != cc.gameMgr._myData.user_base_info.uid) {\n                return\n            }\n\n            var pos = touchNode.parent.convertTouchToNodeSpaceAR(touch)\n            touchNode.position = { x: pos.x - offset.x, y: pos.y - offset.y }\n\n            if (this.isCanSend) {\n                this.isCanSend = false\n                var pos = { x: touchNode.position.x, y: touchNode.position.y, index: this.data.index }\n                cc.netMgr.request(\"room_game_squeeze_cards_pos\", { pos: pos }, function (ret) {\n                    cc.netMgr.exec(ret, function () {\n                    })\n                })\n                //设置发送协议的时间间隔\n                setTimeout(function () {\n                    this.isCanSend = true\n                }.bind(this), 10)\n            }\n\n            if (true == this.isCanSendJiPaiRequest && (Math.abs(touchNode.position.x - oldPos.x) >= size.width / 2 || Math.abs(touchNode.position.y - oldPos.y) >= size.height / 2)) {\n                this.isCanSendJiPaiRequest = false\n                // cc.netMgr.request(\"room_game_squeeze_cards\", { index: serverIndex[this.data.index], state: roleIndex[this.data.index] }, function (ret) {\n                //     cc.netMgr.exec(ret, function () {\n                //     })\n                // })\n                this.requestSqueeze()\n                // this.squeezeComplete()\n            }\n\n        }, this)\n\n        this.find(\"cardBack\").node.on(cc.Node.EventType.TOUCH_END, function (touch) {\n            // cc.log(\"翻牌\")\n            // cc.netMgr.request(\"room_game_squeeze_cards\", { index: serverIndex[this.data.index], state: roleIndex[this.data.index] }, function (ret) {\n            //     cc.netMgr.exec(ret, function () {\n            //     })\n            // })\n            this.requestSqueeze()\n        }, this)\n    },\n\n    //发送挤牌协议\n    requestSqueeze: function () {\n        cc.netMgr.request(\"room_game_squeeze_cards\", { index: serverIndex[this.data.index], state: roleIndex[this.data.index] }, function (ret) {\n            cc.netMgr.exec(ret, function () {\n            })\n        })\n        // this.squeezeComplete()\n    },\n\n    reset: function () {\n        this.data = { num: 0, type: 0, index: 0 }\n        this.isCanSendJiPaiRequest = true\n        this.setSqueeze(false)\n        this.find(\"cardMove\").node.position = { x: 0, y: 0 }\n        this.showNum(false)\n        this.state = cardState.begin\n\n        for (var i = 1; i <= 6; i++) {\n            this[\"tianpai\" + i].getComponent(cc.Animation).stop()\n            this[\"tianpai\" + i].active = false\n\n            this[\"YingPai\" + i].getComponent(cc.Animation).stop()\n            this[\"YingPai\" + i].active = false\n        }\n        this.node.stopAllActions()\n        this.node.setScale(1)\n        this.node.setLocalZOrder(zorder.init)\n    },\n\n    setData: function (cardData, index) {\n        var num = cardData.cards\n        var type = cardData.type\n\n        this.data = { num: num, type: type, index: index }\n        cc.resMgr.updateSprite(this.find(\"cardFront\"), cc.resMgr.getCardResName({ num: num, type: type, index: index }))\n        cc.resMgr.updateSprite(this.find(\"cardBack\"), cc.resMgr.getCardBackName({ index: index }))\n        cc.resMgr.updateSprite(this.find(\"cardMove\"), cc.resMgr.getCardBackName({ index: index }))\n        cc.resMgr.updateSprite(this.find(\"cardNumUp\"), cc.resMgr.getNumRes({ num: this.data.num, type: this.data.type, index: this.data.index }))\n        cc.resMgr.updateSprite(this.find(\"cardNumDown\"), cc.resMgr.getNumRes({ num: this.data.num, type: this.data.type, index: this.data.index }))\n    },\n\n    showTianPaiEffect: function () {\n        var node = this[\"tianpai\" + this.data.index]\n        if (node) {\n            //cc.log(\"天牌特效\" + node.name)\n            this.tianpaiStage = node.getComponent(cc.Animation).play()\n            node.active = true\n        }\n    },\n\n    getTianPaiEffectPlayTime: function () {\n        if (this.tianpaiStage)\n        {\n            var time = this.tianpaiStage.duration\n            this.tianpaiStage = null\n            cc.log(\"天牌特效时间：\" + time)\n            return time\n        }\n        return 0\n    },\n\n    showYingPaiEffect: function () {\n        // var node = this[\"YingPai\" + this.data.index]\n        // if (node) {\n        //     if (this.tianpaiStage)\n        //     {\n        //         cc.log(\"天牌特效时间：\" + this.tianpaiStage.duration)\n        //         cc.director.getScheduler().schedule(function () {\n        //             cc.log(\"tianpaiStage赢牌特效\" + node.name)\n        //             node.getComponent(cc.Animation).play()\n        //             node.active = true\n        //             this.tianpaiStage = null\n        //         }, this, this.tianpaiStage.duration, 0, 0, false);\n        //         return\n        //     }\n        //     cc.log(\"赢牌特效\" + node.name)\n        //     node.getComponent(cc.Animation).play()\n        //     node.active = true\n        // }\n    },\n\n    showBack: function () {\n        this.find(\"cardBack\").node.active = true\n        this.find(\"cardFront\").node.active = false\n    },\n\n    showFront: function () {\n        this.find(\"cardBack\").node.active = false\n        this.find(\"cardFront\").node.active = true\n    },\n\n    flip: function () {\n        if (this.state == cardState.end) {\n            return\n        }\n        else if (this.state == cardState.isJi) {\n            this.squeezeComplete()\n        }\n        else {\n            this.state = cardState.onFlipAct\n            var cb1 = cc.callFunc(function () {\n                this.showFront()\n            }.bind(this))\n            var cb2 = cc.callFunc(function () {\n                // cc.musicMgr.playEffect(\"flip_card.mp3\")\n                // cc.gameMgr.view.showScore()\n                this.squeezeComplete()\n            }.bind(this))\n            var act1 = cc.sequence(cc.scaleTo(0.2, 0, 1), cb1)\n            var act2 = cc.sequence(cc.scaleTo(0.2, 1, 1), cb2)\n            var seq = cc.sequence(act1, act2)\n            this.node.runAction(seq)\n        }\n    },\n\n    isOnFlip: function () {\n        return this.state == cardState.onFlipAct || this.state == cardState.backToNormal\n    },\n\n    isNeedJi: function () {\n        return this.state == cardState.isJi\n    },\n\n    showNum: function (isShow) {\n        if (isShow) {\n            this.find(\"cardNumUp\").node.active = true\n            this.find(\"cardNumDown\").node.active = true\n        }\n        else {\n            this.find(\"cardNumUp\").node.active = false\n            this.find(\"cardNumDown\").node.active = false\n        }\n    },\n\n    //判断牌是否正面朝上状态\n    isFront: function () {\n        return this.find(\"cardFront\").node.active && !this.isSquezze()\n    },\n\n    dealMove: function (pos, callback) {\n        //为了避免协议堵塞导致动画播放顺序乱的问题\n        if (this.state > cardState.dealMove) {\n            return\n        }\n        this.state = cardState.dealMove\n        this.node.stopAllActions()\n        this.node.setScale(1)\n        this.showNum(false)\n        this.node.setLocalZOrder(zorder.onDeal)\n        var time = 0.5\n        var moveTo = cc.moveTo(time, pos)\n        var cb = cc.callFunc(function () {\n            if (callback) {\n                callback()\n            }\n            this.node.setLocalZOrder(zorder.normal + this.data.index)\n        }.bind(this))\n        var spawn = cc.spawn(moveTo, cc.rotateTo(time, 0))\n        var seq = cc.sequence(spawn, cb)\n        this.node.runAction(seq)\n    },\n\n    move: function (pos) {\n        this.node.stopAllActions()\n        this.node.setScale(1)\n        var time = 0.5\n        var moveTo = cc.moveTo(time, pos)\n        this.node.runAction(moveTo)\n    },\n\n    //移动到挤牌的那个位置\n    moveToSqueeze: function (pos) {\n        if (this.state > cardState.dealMove) {\n            return\n        }\n        this.state = cardState.moveToJi\n        this.node.setLocalZOrder(zorder.onJi) //改变挤牌时的层级关系\n        var cbFunc = function () {\n            this.state = cardState.isJi\n            this.showFront()\n            this.setSqueeze(true)\n            // this.node.setScale(1)\n            this.node.setScale(getScaleParam(2))\n            this.node.setRotation(0)\n            var data = this.data\n            cc.resMgr.updateSprite(this.find(\"cardFront\"), cc.resMgr.getJiPaiResName({ type: data.type, num: data.num, index: data.index, isBack: false }))\n            cc.resMgr.updateSprite(this.find(\"cardMove\"), cc.resMgr.getJiPaiResName({ type: data.type, num: data.num, index: data.index, isBack: true }))\n            if (cc.gameMgr.getSqueezeType() == squeezeType.threeD) {\n                // this.find(\"cardNode\").active = false\n                var scale\n                if (cc.gameMgr.curJipaiPlayerUid == cc.gameMgr._myData.user_base_info.uid) {\n                    var isWrite = cc.sys.localStorage.getItem(\"firstSqueeze\") ? true : false\n                    cc.log(\"firstSqueeze: isWrite\", isWrite)\n                    this.showFirstSquezze(!isWrite)\n                    scale = 1\n                } else {\n                    scale = 0.35\n                }\n                this.cardNode.active = false\n                this.threeDNode = new cc.Node(\"threeDNode\")\n                this.threeDNode.parent = this.node.parent\n                this.threeDNode.position = this.node.position\n                this.threeDCardJs = this.threeDNode.addComponent(\"ThreeDCard\")\n                this.threeDCardJs.init({\n                    front: cc.resMgr.getJiPaiResName({ type: data.type, num: data.num, index: data.index, isBack: false }),\n                    back: cc.resMgr.getJiPaiResName({ index: data.index, isBack: true }), cardJs: this, scale: scale\n                })\n                this.threeDNode.setContentSize(this.threeDCardJs.getSize())\n            }\n        }.bind(this)\n\n        if (pos.x == this.node.position.x && pos.y == this.node.position.y) {\n            cbFunc()\n        }\n        else {\n            this.node.stopAllActions()\n            this.node.setScale(1)\n            var moveTo = cc.moveTo(0.5, pos)\n            // var actionTo = cc.scaleTo(0.5, scale1)\n            var actionTo = cc.scaleTo(0.5, getScaleParam(1))\n            var spawn = cc.spawn(moveTo, actionTo)\n            var cb = cc.callFunc(cbFunc)\n            var seq = cc.sequence(spawn, cb)\n            this.node.runAction(seq)\n        }\n    },\n\n    //挤牌完成\n    squeezeComplete: function (bBuPai) {\n        this.showFirstSquezze(false)\n        if (!cc.sys.localStorage.getItem(\"firstSqueeze\") && this.state == cardState.isJi) \n        {\n            cc.log(\"setFirstSqueeze\" + \"   stage\" + this.state)\n            cc.sys.localStorage.setItem(\"firstSqueeze\", 1)\n        }    \n        this.state = cardState.backToNormal\n        this.setSqueeze(false)\n        if (cc.gameMgr.getSqueezeType() == squeezeType.threeD) {\n            // this.find(\"cardNode\").active = true\n            this.cardNode.active = true\n            if (this.threeDCardJs) {\n                this.node.rotation = this.threeDCardJs.rotateAngle\n                this.threeDCardJs.releaseGL()\n                this.threeDCardJs.destroy()\n            }\n        }\n        // this.find(\"cardNode\").active = true\n        this.cardNode.active = true\n        this.showNum(true)\n        this.showFront(true)\n        cc.gameMgr.view.showScore()\n        cc.musicMgr.playEffect(\"flip_card.mp3\")\n        //回去对应的位置\n\n        var cbFunc = function () {\n            this.state = cardState.end\n            this.node.setScale(1)\n            this.node.setRotation(0)\n            cc.resMgr.updateSprite(this.find(\"cardFront\"), cc.resMgr.getCardResName({ num: this.data.num, type: this.data.type, index: this.data.index }))\n            this.showNum(false)\n            // this.node.setLocalZOrder(zorder.normal)\n            this.node.setLocalZOrder(zorder.normal + this.data.index)\n            cc.gameMgr.checkFlip()\n            cc.gameMgr.checkDelaySqueeze()\n        }.bind(this)\n        var pos = cc.gameMgr.view.find(\"posCard\" + this.data.index).node.position\n        if(bBuPai){\n            pos = cc.gameMgr.view.find(\"dieposCard\" + this.data.index).node.position\n        }\n        if (pos.x == Math.round(this.node.position.x) && pos.y == Math.round(this.node.position.y)) {\n            cbFunc()\n        }\n        else {\n            this.node.stopAllActions()\n            // this.node.setScale(1)\n            this.node.setScale(getScaleParam(2))\n            var moveTo = cc.moveTo(0.5, pos)\n            // var actionTo = cc.scaleTo(0.5, scale2)\n            var actionTo = cc.scaleTo(0.5, getScaleParam(3))\n            var spawn = cc.spawn(moveTo, actionTo)\n            var cb = cc.callFunc(cbFunc)\n            var seq = cc.sequence(cc.delayTime(0.5), spawn, cb)\n            this.node.runAction(seq)\n        }\n    },\n\n    //比牌动作\n    compare: function () {\n        if (this.data.index) {\n            this.node.stopAllActions()\n            this.node.setScale(1)\n            this.node.setLocalZOrder(zorder.onCompare + this.data.index)\n            var pos = cc.gameMgr.view.find(\"compareCard\" + this.data.index).node.position\n            //策划的需求，如果有补牌，则需要把第二张牌叠在第一章牌上\n            if ((2 == this.data.index && true == cc.gameMgr.view.cardList[5].active) || 4 == this.data.index && true == cc.gameMgr.view.cardList[6].active) {\n                pos = cc.gameMgr.view.find(\"diecompareCard\" + this.data.index).node.position\n            }\n            var moveTo = cc.moveTo(0.5, pos)\n            var scaleTo = cc.scaleTo(0.5, 1.2)\n            var spawn = cc.spawn(moveTo, scaleTo)\n            this.node.runAction(spawn)\n        }\n    },\n\n    //是否挤牌\n    setSqueeze: function (bool) {\n        this.find(\"cardMove\").node.active = bool\n    },\n\n    isSquezze: function () {\n        return this.find(\"cardMove\").node.active\n    },\n\n    getIndex: function () {\n        return this.data.index\n    },\n\n    getCardNum: function () {\n        return this.data.num\n    },\n\n    getCardType: function () {\n        return this.data.type\n    },\n\n    //扑克是属于庄还是属于闲 1庄 2闲\n    getCardOwner: function () {\n        var zhuangList = [3, 4, 6]\n        var xianList = [1, 2, 5]\n        if (zhuangList.indexOf(this.getIndex()) != -1) {\n            return 1\n        }\n        else {\n            return 2\n        }\n    },\n\n    showFirstSquezze: function (isFirst) {\n        if (this.firstSqueezeNode.active != isFirst)\n        {\n            this.firstSqueezeNode.active = isFirst\n        }\n    }\n});\n"]}