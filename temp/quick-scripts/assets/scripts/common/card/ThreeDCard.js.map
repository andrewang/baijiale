{"version":3,"sources":["ThreeDCard.js"],"names":["cc","Class","extends","Component","properties","label","default","type","Label","isCanSend","onLoad","init","params","sys","isBrowser","posX","posY","offsetRatioval","ratioVal","radiusVal","rotateAngle","szBack","back","szFont","front","pokerScale","scale","RubCardLayer_State_Move","RubCardLayer_State_Smooth","RubCardLayer_Pai","RubCardLayer_RotationFrame","RubCardLayer_RotationAnger","RubCardLayer_SmoothFrame","RubCardLayer_SmoothAnger","limitRatioVal","state","createTextures","initTexAndPos","createGlNode","createAllProgram","registTouchEvent","pokerHeight","rotate","cb","releaseGL","node","rotation","bind","callbackfunc","callFunc","seq","sequence","rotateBy","runAction","glnode","GLNode","_sgNode","addChild","smoothFrame","isCreateNum","draw","drawByMoveProgram","cardJs","requestSqueeze","drawByEndProgram","startPt","endPt","on","Node","EventType","TOUCH_START","touch","showFirstSquezze","getLocation","location","touchStartY","y","TOUCH_MOVE","gameMgr","curJipaiPlayerUid","_myData","user_base_info","uid","Math","max","min","pos","index","data","netMgr","request","ret","exec","setTimeout","endFunc","pDistance","isRotate","TOUCH_END","TOUCH_CANCEL","moveVertSource","require","smoothVertSource","endVertSource","strFragSource","moveGlProgram","createProgram","smoothGlProgram","endGlProgram","retain","rotationLc","gl","getUniformLocation","getProgram","ratio","radius","offx","offy","Height","Width","vsource","fsource","glProgram","GLProgram","createWithByteArrays","link","updateUniforms","enable","CULL_FACE","use","setUniformsForBuiltins","setUniformLocationF32","pokerWidth","bindTexture","TEXTURE_2D","backSpriteId","drawArrays","backPosBuffer","backTexBuffer","frontSpriteId","frontPosBuffer","frontTexBuffer","disable","drawBySmoothProgram","tex","VERTEX_ATTRIB_FLAG_POSITION","VERTEX_ATTRIB_FLAG_TEX_COORDS","glEnableVertexAttribs","VERTEX_ATTRIB_POSITION","VERTEX_ATTRIB_TEX_COORDS","bindBuffer","ARRAY_BUFFER","vertexAttribPointer","FLOAT","TRIANGLES","posTexNum","isBack","nDiv","verts","Array","texs","dh","dw","c","x","quad","i","quadX","quadY","numX","numY","push","k","posBuffer","createBuffer","bufferData","Float32Array","STATIC_DRAW","length","texBuffer","buffer_id","imgUrl","url","raw","frontSprite","textureCache","addImage","backSprite","pokerSize","getContentSize","width","height","getName","log","removeChild","_deleteBuffer","release","getSize"],"mappings":"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","file":"ThreeDCard.js","sourceRoot":"../../../../../../assets/scripts/common/card","sourcesContent":["cc.Class({\n    extends: cc.Component,\n\n    properties: {\n        label: {\n            default: null,\n            type: cc.Label\n        },\n        isCanSend: true,\n    },\n\n    onLoad: function () {\n\n    },\n\n    init: function (params) {\n        if (cc.sys.isBrowser) {\n            return\n        }\n        this.params = params\n        this.posX = 0\n        this.posY = 0\n        this.offsetRatioval = 0\n        this.ratioVal = 0\n        this.radiusVal = 0\n        this.rotateAngle = 0\n        // this.szBack = \"threeDCards/kabei.png\"\n        // this.szFont = \"threeDCards/black_3.png\"\n        // this.szBack = (params && params.back) || \"poker_head_left_1/poker.png\"\n        // this.szFont = (params && params.front) || \"poker_head_left_1/poker_red_j.png\"\n        this.szBack = (params && params.back) || \"threeDCards/kabei.png\"\n        this.szFont = (params && params.front) || \"threeDCards/red_j.png\"\n        this.pokerScale = (params && params.scale) || 1\n        this.RubCardLayer_State_Move = 0\n        this.RubCardLayer_State_Smooth = 1\n        var RubCardLayer_Pai = 3.141592\n        this.RubCardLayer_RotationFrame = 10\n        this.RubCardLayer_RotationAnger = RubCardLayer_Pai / 3\n        this.RubCardLayer_SmoothFrame = 10\n        this.RubCardLayer_SmoothAnger = RubCardLayer_Pai / 6\n        this.limitRatioVal = 0.96\n\n        this.state = this.RubCardLayer_State_Move\n\n        this.createTextures()\n        this.initTexAndPos(true)\n        this.initTexAndPos(false)\n        this.createGlNode()\n        this.createAllProgram()\n        this.registTouchEvent()\n        this.radiusVal = this.pokerHeight / 10\n    },\n\n    rotate: function () {\n        this.ratioVal = 0 //旋转ratioVal从0开始计算\n        if (90 == this.rotateAngle) {\n            this.rotateAngle = 0\n        }\n        else if (0 == this.rotateAngle) {\n            this.rotateAngle = 90\n        }\n\n        var cb = function () {\n            this.releaseGL()\n            \n            if (0 == this.rotateAngle) {\n                this.limitRatioVal = 0.96\n                //\b无限旋转\n                this.node.rotation = 0\n            }\n            else if (90 == this.rotateAngle) {\n                this.limitRatioVal = 0.68\n            }\n\n            this.createTextures()\n            this.initTexAndPos(true)\n            this.initTexAndPos(false)\n            this.createGlNode()\n            this.createAllProgram()\n        }.bind(this)\n\n        var callbackfunc = cc.callFunc(function () {\n            cb()\n        }.bind(this))\n        // var seq = cc.sequence(cc.rotateTo(0.2, -this.rotateAngle), callbackfunc)\n        var seq = cc.sequence(cc.rotateBy(0.2, -90), callbackfunc)\n        this.node.runAction(seq)\n        // cb()\n    },\n\n    createGlNode: function () {\n        var glnode = new cc.GLNode()\n        this.node._sgNode.addChild(glnode, 10)\n        this.glnode = glnode\n        this.smoothFrame = 1\n        this.isCreateNum = false\n\n        glnode.draw = function () {\n            if (this.state == this.RubCardLayer_State_Move) {\n                this.drawByMoveProgram(0)\n            }\n            else if (this.state == this.RubCardLayer_State_Smooth) {\n                if (this.params && this.params.cardJs) {\n                    this.params.cardJs.requestSqueeze()\n                    this.params = null //避免多次发送协议\n                    return\n                }\n                //如果旋转了，角度也要摆正\n                // this.node.rotation = 0\n                \n                if (this.smoothFrame <= this.RubCardLayer_RotationFrame) {\n                    // this.drawByMoveProgram(-this.RubCardLayer_RotationAnger*this.smoothFrame/this.RubCardLayer_RotationFrame)\n                }\n                else if (this.smoothFrame < (this.RubCardLayer_RotationFrame + this.RubCardLayer_SmoothFrame)) {\n                    var scale = (this.smoothFrame - this.RubCardLayer_RotationFrame) / this.RubCardLayer_SmoothFrame\n                    // this.drawBySmoothProgram(Math.max(0.01,this.RubCardLayer_SmoothAnger*(1-scale)))\n                }\n                else {\n                    //第一次到这里就铺平了\n                    this.drawByEndProgram()\n                }\n                this.smoothFrame = this.smoothFrame + 1\n            }\n        }.bind(this)\n    },\n\n    registTouchEvent: function () {\n        var startPt, endPt\n        this.node.on(cc.Node.EventType.TOUCH_START, function (touch) {\n            this.params.cardJs.showFirstSquezze(false)\n            startPt = touch.getLocation()\n            var location = touch.getLocation()\n            this.touchStartY = location.y\n        }.bind(this), this)\n        this.node.on(cc.Node.EventType.TOUCH_MOVE, function (touch) {\n            if (cc.gameMgr.curJipaiPlayerUid != cc.gameMgr._myData.user_base_info.uid) {\n                return\n            }\n            var location = touch.getLocation()\n            this.ratioVal = (location.y - this.touchStartY) / this.pokerHeight + this.offsetRatioval\n            this.ratioVal = Math.max(0, this.ratioVal)\n            this.ratioVal = Math.min(this.limitRatioVal, this.ratioVal)\n\n            if (this.isCanSend) {\n                this.isCanSend = false\n                var pos = { ratioVal : this.ratioVal, index: this.params.cardJs.data.index }\n                cc.netMgr.request(\"room_game_squeeze_cards_pos\", { pos: pos }, function (ret) {\n                    cc.netMgr.exec(ret, function () {\n                    })\n                })\n                //设置发送协议的时间间隔\n                setTimeout(function () {\n                    this.isCanSend = true\n                }.bind(this), 10)\n            }\n\n        }.bind(this), this)\n\n        var endFunc = function (touch) {\n            if (cc.gameMgr.curJipaiPlayerUid != cc.gameMgr._myData.user_base_info.uid) {\n                return\n            }\n            endPt = touch.getLocation()\n            //点击旋转\n            if (this.ratioVal <= 0.05 && cc.pDistance(startPt, endPt) <= 10) {\n                var pos = { isRotate : true, index: this.params.cardJs.data.index }\n                cc.netMgr.request(\"room_game_squeeze_cards_pos\", { pos: pos }, function (ret) {\n                    cc.netMgr.exec(ret, function () {\n                    })\n                })\n                this.rotate()\n            }\n            this.offsetRatioval = this.ratioVal\n            if (this.ratioVal >= this.limitRatioVal) {\n                this.state = this.RubCardLayer_State_Smooth\n            }\n        }.bind(this)\n        this.node.on(cc.Node.EventType.TOUCH_END, endFunc, this)\n        this.node.on(cc.Node.EventType.TOUCH_CANCEL, endFunc, this)\n    },\n\n    createAllProgram: function () {\n        var moveVertSource = require(\"move.vert\")\n        var smoothVertSource = require(\"smooth.vert\")\n        var endVertSource = require(\"end.vert\")\n\n        var strFragSource = require(\"jipai.frag\")\n\n        var moveGlProgram = this.moveGlProgram = this.createProgram(moveVertSource, strFragSource)\n        var smoothGlProgram = this.smoothGlProgram = this.createProgram(smoothVertSource, strFragSource)\n        var endGlProgram = this.endGlProgram = this.createProgram(endVertSource, strFragSource)\n        this.moveGlProgram.retain()\n        this.smoothGlProgram.retain()\n        this.endGlProgram.retain()\n\n        moveGlProgram.rotationLc = gl.getUniformLocation(moveGlProgram.getProgram(), \"rotationLc\")\n        moveGlProgram.ratio = gl.getUniformLocation(moveGlProgram.getProgram(), \"ratio\")\n        moveGlProgram.radius = gl.getUniformLocation(moveGlProgram.getProgram(), \"radius\")\n        moveGlProgram.offx = gl.getUniformLocation(moveGlProgram.getProgram(), \"offx\")\n        moveGlProgram.offy = gl.getUniformLocation(moveGlProgram.getProgram(), \"offy\")\n        moveGlProgram.Height = gl.getUniformLocation(moveGlProgram.getProgram(), \"height\")\n        moveGlProgram.Width = gl.getUniformLocation(moveGlProgram.getProgram(), \"width\")\n        moveGlProgram.rotation = gl.getUniformLocation(moveGlProgram.getProgram(), \"rotation\")\n\n        smoothGlProgram.rotationLc = gl.getUniformLocation(smoothGlProgram.getProgram(), \"rotationLc\")\n        smoothGlProgram.offx = gl.getUniformLocation(smoothGlProgram.getProgram(), \"offx\")\n        smoothGlProgram.offy = gl.getUniformLocation(smoothGlProgram.getProgram(), \"offy\")\n        smoothGlProgram.Height = gl.getUniformLocation(smoothGlProgram.getProgram(), \"height\")\n        smoothGlProgram.Width = gl.getUniformLocation(smoothGlProgram.getProgram(), \"width\")\n\n        endGlProgram.offx = gl.getUniformLocation(endGlProgram.getProgram(), \"offx\")\n        endGlProgram.offy = gl.getUniformLocation(endGlProgram.getProgram(), \"offy\")\n        endGlProgram.Height = gl.getUniformLocation(endGlProgram.getProgram(), \"height\")\n        endGlProgram.Width = gl.getUniformLocation(endGlProgram.getProgram(), \"width\")\n        endGlProgram.rotation = gl.getUniformLocation(endGlProgram.getProgram(), \"rotation\")\n    },\n\n    createProgram: function (vsource, fsource) {\n        var glProgram = cc.GLProgram.createWithByteArrays(vsource, fsource)\n        glProgram.link()\n        glProgram.updateUniforms()\n        return glProgram\n    },\n\n    drawByMoveProgram: function (rotationLc) {\n        var glProgram = this.moveGlProgram\n        gl.enable(gl.CULL_FACE)\n        glProgram.use()\n        glProgram.setUniformsForBuiltins()\n\n        glProgram.setUniformLocationF32(glProgram.rotationLc, rotationLc)\n        glProgram.setUniformLocationF32(glProgram.ratio, this.ratioVal)\n        glProgram.setUniformLocationF32(glProgram.radius, this.radiusVal)\n        glProgram.setUniformLocationF32(glProgram.offx, this.offx)\n        glProgram.setUniformLocationF32(glProgram.offy, this.offy)\n        glProgram.setUniformLocationF32(glProgram.Height, this.pokerHeight)\n        glProgram.setUniformLocationF32(glProgram.Width, this.pokerWidth)\n        glProgram.setUniformLocationF32(glProgram.rotation, this.rotateAngle)\n\n        gl.bindTexture(gl.TEXTURE_2D, this.backSpriteId)\n        this.drawArrays(this.backPosBuffer, this.backTexBuffer)\n        gl.bindTexture(gl.TEXTURE_2D, this.frontSpriteId)\n        this.drawArrays(this.frontPosBuffer, this.frontTexBuffer)\n        gl.disable(gl.CULL_FACE)\n    },\n\n    drawBySmoothProgram: function (rotationLc) {\n        var glProgram = this.smoothGlProgram\n        glProgram.use()\n        glProgram.setUniformsForBuiltins()\n\n        gl.bindTexture(gl.TEXTURE_2D, this.frontSpriteId)\n        glProgram.setUniformLocationF32(glProgram.rotationLc, rotationLc)\n        glProgram.setUniformLocationF32(glProgram.offx, this.offx)\n        glProgram.setUniformLocationF32(glProgram.offy, this.offy)\n        glProgram.setUniformLocationF32(glProgram.Height, this.pokerHeight)\n        glProgram.setUniformLocationF32(glProgram.Width, this.pokerWidth)\n\n        this.drawArrays(this.frontPosBuffer, this.frontTexBuffer)\n    },\n\n    drawByEndProgram: function () {\n        var glProgram = this.endGlProgram\n        glProgram.use()\n        glProgram.setUniformsForBuiltins()\n\n        gl.bindTexture(gl.TEXTURE_2D, this.frontSpriteId)\n        glProgram.setUniformLocationF32(glProgram.offx, this.offx)\n        glProgram.setUniformLocationF32(glProgram.offy, this.offy)\n        glProgram.setUniformLocationF32(glProgram.Height, this.pokerHeight)\n        glProgram.setUniformLocationF32(glProgram.Width, this.pokerWidth)\n        glProgram.setUniformLocationF32(glProgram.rotation, this.rotateAngle)\n        this.drawArrays(this.frontPosBuffer, this.frontTexBuffer)\n    },\n\n    drawArrays: function (pos, tex) {\n        var VERTEX_ATTRIB_FLAG_POSITION = 1\n        var VERTEX_ATTRIB_FLAG_TEX_COORDS = 4\n        // cc.glEnableVertexAttribs(VERTEX_ATTRIB_FLAG_TEX_COORDS | VERTEX_ATTRIB_FLAG_POSITION)\n        gl.glEnableVertexAttribs(VERTEX_ATTRIB_FLAG_TEX_COORDS | VERTEX_ATTRIB_FLAG_POSITION)\n        var VERTEX_ATTRIB_POSITION = 0\n        var VERTEX_ATTRIB_TEX_COORDS = 2\n        gl.bindBuffer(gl.ARRAY_BUFFER, pos)\n        gl.vertexAttribPointer(VERTEX_ATTRIB_POSITION, 2, gl.FLOAT, 0, 0, 0)\n        gl.bindBuffer(gl.ARRAY_BUFFER, tex)\n        gl.vertexAttribPointer(VERTEX_ATTRIB_TEX_COORDS, 2, gl.FLOAT, 0, 0, 0)\n        gl.drawArrays(gl.TRIANGLES, 0, this.posTexNum)\n        gl.bindBuffer(gl.ARRAY_BUFFER, 0)\n    },\n\n    initTexAndPos: function (isBack) {\n        var nDiv = 20 //将宽分成100份\n        var verts = new Array() //位置坐标\n        var texs = new Array() //纹理坐标\n        var dh, dw\n        if (0 == this.rotateAngle) {\n            dh = this.pokerHeight / nDiv\n            dw = this.pokerWidth\n        }\n        else if (90 == this.rotateAngle) {\n            dh = this.pokerHeight\n            dw = this.pokerWidth / nDiv\n        }\n\n        //计算顶点位置\n        for (var c = 1; c <= nDiv; c++) {\n            var x, y\n            if (0 == this.rotateAngle) {\n                x = 0\n                y = (c - 1) * dh\n            }\n            else if (90 == this.rotateAngle) {\n                x = (c - 1) * dw\n                y = 0\n            }\n\n            var quad = null\n            if (isBack) {\n                quad = new Array(x, y, x + dw, y, x, y + dh, x + dw, y, x + dw, y + dh, x, y + dh)\n            }\n            else {\n                quad = new Array(x, y, x, y + dh, x + dw, y, x + dw, y, x, y + dh, x + dw, y + dh)\n            }\n            for (var i = 0; i <= 5; i++) {\n                var quadX = quad[i * 2]\n                var quadY = quad[i * 2 + 1]\n                var numX = quadX / this.pokerWidth\n                var numY = quadY / this.pokerHeight\n                texs.push(Math.max(0, numX))\n                texs.push(Math.max(0, numY))\n            }\n            for (var k in quad) {\n                verts.push(quad[k])\n            }\n        }\n        var posBuffer = gl.createBuffer()\n        gl.bindBuffer(gl.ARRAY_BUFFER, posBuffer)\n        gl.bufferData(gl.ARRAY_BUFFER, new Float32Array(verts), gl.STATIC_DRAW)\n        gl.bindBuffer(gl.ARRAY_BUFFER, null)\n        this.posTexNum = verts.length / 2\n\n        var texBuffer = gl.createBuffer()\n        gl.bindBuffer(gl.ARRAY_BUFFER, texBuffer)\n        gl.bufferData(gl.ARRAY_BUFFER, new Float32Array(texs), gl.STATIC_DRAW)\n        gl.bindBuffer(gl.ARRAY_BUFFER, null)\n        if (isBack) {\n            this.backPosBuffer = posBuffer.buffer_id\n            this.backTexBuffer = texBuffer.buffer_id\n        }\n        else {\n            this.frontPosBuffer = posBuffer.buffer_id\n            this.frontTexBuffer = texBuffer.buffer_id\n        }\n    },\n\n    createTextures: function () {\n        var imgUrl = cc.url.raw(\"resources/\" + this.szFont)\n        this.frontSprite = cc.textureCache.addImage(imgUrl)\n        this.frontSprite.retain()\n\n        imgUrl = cc.url.raw(\"resources/\" + this.szBack)\n        this.backSprite = cc.textureCache.addImage(imgUrl)\n        this.backSprite.retain()\n\n        var pokerSize = this.backSprite.getContentSize()\n        this.pokerWidth = pokerSize.width * this.pokerScale\n        this.pokerHeight = pokerSize.height * this.pokerScale\n\n        this.offx = this.posX - this.pokerWidth / 2\n        this.offy = this.posY - this.pokerHeight / 2\n        this.backSpriteId = this.backSprite.getName()\n        this.frontSpriteId = this.frontSprite.getName()\n    },\n\n    //结束需要移除\n    releaseGL: function () {\n        cc.log(\"3d挤牌onDestroy\")\n        if (cc.sys.isBrowser) {\n            return\n        }\n        if (!this.node) {\n            return\n        }\n        this.node._sgNode.removeChild(this.glnode)\n        gl._deleteBuffer(this.backPosBuffer)\n        gl._deleteBuffer(this.backTexBuffer)\n        gl._deleteBuffer(this.frontPosBuffer)\n        gl._deleteBuffer(this.frontTexBuffer)\n        this.moveGlProgram.release()\n        this.smoothGlProgram.release()\n        this.endGlProgram.release()\n        this.backSprite.release()\n        this.frontSprite.release()\n    },\n\n    getSize: function () {\n        return { width: this.pokerWidth, height: this.pokerHeight }\n    },\n})\n\n"]}