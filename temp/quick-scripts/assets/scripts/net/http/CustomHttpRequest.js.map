{"version":3,"sources":["CustomHttpRequest.js"],"names":["cc","Class","extends","Component","properties","_requestType","_fileName","xhr","_url","_timeOut","isEnd","_data","init","loader","getXMLHttpRequest","timeout","onload","log","onloadend","onloadstart","onabort","self","onerror","abort","_timeOutOrErrorCb","setRequestType","requestType","setUrl","url","setFile","fileName","setData","data","setTimeout","timeOut","startTimeOutTimer","timeOutCb","interval","repeat","delay","Math","ceil","pause","director","getScheduler","schedule","timeOutCB","console","clearTimeOutTimer","unschedule"],"mappings":"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","file":"CustomHttpRequest.js","sourceRoot":"../../../../../../assets/scripts/net/http","sourcesContent":["cc.Class({\n    extends: cc.Component,\n\n    properties: {\n        _requestType : 'GET',\n        _fileName : '',\n        xhr : null,\n        _url : '',\n        _timeOut : 10000,\n        isEnd : false,\n        _data : '',\n    },\n\n    init : function(){\n        if(!this.xhr){\n            this.xhr = cc.loader.getXMLHttpRequest(); \n            this.xhr.timeout = this._timeOut;\n            this.xhr.onload = function () {\n                cc.log('customhttprequest onload');\n            }\n            this.xhr.onloadend = function () {\n                cc.log('customhttprequest onloadend');\n            }\n    \n            this.xhr.onloadstart = function () {\n                cc.log('customhttprequest onloadstart');\n            }\n    \n            this.xhr.onabort = function () {\n                cc.log('customhttprequest onabort');\n            }\n            var self = this;\n            this.xhr.onerror = function () {\n                cc.log('customhttprequest onerror');\n                if(self.isEnd == false){\n                    self.isEnd = true;\n                    self.xhr.abort();\n                    if(self._timeOutOrErrorCb){\n                        self._timeOutOrErrorCb();\n                    }\n                }\n            }\n        }\n    },\n\n    setRequestType : function(requestType){\n        this.init();\n        this._requestType = requestType;\n    },\n\n    setUrl : function(url){\n        this.init();\n        this._url = url;\n    },\n\n    setFile : function(fileName){\n        this.init();\n        this._fileName = fileName;\n    },\n\n    setData : function(data){\n        this._data = data;\n    },\n\n    setTimeout : function(timeOut){\n        this.init();\n        this._timeOut = timeOut;\n        this.xhr.timeout = timeOut;\n    },\n\n    startTimeOutTimer : function(timeOutCb){\n        var interval = 1;\n        var repeat = 0;\n        var delay = Math.ceil( this._timeOut / 1000 ) ;\n        var pause = false;\n        this._timeOutOrErrorCb = timeOutCb;\n        cc.director.getScheduler().schedule(this.timeOutCB,this, interval,repeat,delay,pause);\n    },\n\n    timeOutCB : function(){\n        console.log('CustomHttpRequest 超时');\n        if(this.isEnd == false){\n            this.isEnd = true;\n            this.xhr.abort();\n            this._timeOutOrErrorCb();\n        }\n\n    },\n\n    clearTimeOutTimer : function(){\n        cc.director.getScheduler().unschedule(this.timeOutCB,this);\n    }\n});\n"]}