{"version":3,"sources":["LobbyScene.js"],"names":["BaseScene","require","childViewIndex","Code","NetMgr","EventMgr","ResMgr","GameToAppHelper","http","cc","Class","extends","properties","moduleName","override","default","visible","onLoad","_super","isInit","login","txtUid","find","string","txtName","txt_diamonds","txt_roomCard","initListener","musicMgr","playLobbyBgm","updatePlayerInfo","requestNotice","handleExamine","eventMgr","addEvent","requestResultData","eventHideListener","eventManager","addCustomListener","game","EVENT_HIDE","event","log","bind","eventShowListener","EVENT_SHOW","netMgr","onAppFront","onDestroy","removeEvent","removeListener","update","handleData","sceneNode","js","showLoadingView","gUserData","dingdingData","uToken","requestValidate","loginFunc","sendRequest","game_id","ret","exec","list","data","items","view","openView","setData","hide","i","length","pop_up","prefab","res","instantiate","parent","node","_components","show","msg","telephone","uid","toString","password","system","version","status","user_id","auth_key","gHost","socket","code","common","showMsgBox","type","getCodeName","close","director","getScene","_name","ROOM_PLAYER_NOT_IN_ROOM","loadScene","JSON","stringify","hideLoadingView","roomId","requestFindRoom","roomInfo","room_info","emit","start","rid","OK","roomInfoView","clone","isRepetitionBar","sys","isBrowser","codeNumber","isCanShow","request","user_base_info","playerInfo","i18n","dd_no","ding_no","name","diamonds","room_card","resMgr","loadNetUrl","avatar","onBtnCreateRoom","isForbidGame","onBtnJoinRoom","okCb","ExitGame","disGame_baijiale","onBTNBack","onBtnSetting","active","onBtnMall","eventTouch","param","Number","showRecordView","showRuleView","onBtnShare","onBtnNotices","page","lastResultData","room_record_info_list","setTotalBattleRecordData","IS_EXAMINE"],"mappings":"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","file":"LobbyScene.js","sourceRoot":"../../../../../../assets/scripts/app/lobby","sourcesContent":["var BaseScene = require(\"BaseScene\");\r\nvar childViewIndex = require(\"LobbyConfig\").childViewIndex\r\n// var CustomHttpRequest = require(\"CustomHttpRequest\")\r\n// var CustomHttpClient = require(\"CustomHttpClient\")\r\nvar Code = require('Code');\r\n// var ProtoUtil = require(\"ProtoUtil\")\r\nvar NetMgr = require(\"NetMgr\")\r\nvar EventMgr = require(\"EventMgr\")\r\nvar ResMgr = require(\"ResMgr\")\r\nvar GameToAppHelper = require(\"GameToAppHelper\")\r\nvar http = require(\"Http\");\r\n\r\ncc.Class({\r\n    extends: BaseScene,\r\n    properties: {\r\n        moduleName: {\r\n            override: true,\r\n            default: \"Lobby\",\r\n            // type: 'String',\r\n            visible: false,\r\n        },\r\n\r\n        // childViews:{\r\n        //     type:cc.Prefab,\r\n        //     default:[]\r\n        // }\r\n    },\r\n\r\n    onLoad: function () {\r\n        // this.node.on(\"test\", function (event) {\r\n        //     cc.log(\"test\", event.detail)\r\n        // })\r\n        //初始化\r\n        this._super()\r\n        if (!isInit) {\r\n            isInit = true\r\n            // cc.netMgr = new NetMgr()\r\n            // cc.netMgr.initData()\r\n            // cc.eventMgr = new EventMgr()\r\n            // cc.resMgr = new ResMgr()\r\n            // cc.resMgr.init()\r\n            // cc.res = cc.resMgr.resList\r\n            this.login()\r\n        }\r\n\r\n        this.txtUid = this.find(\"txtUid\")\r\n        this.txtUid.string = \"\"\r\n        this.txtName = this.find(\"txtName\")\r\n        this.txtName.string = \"\"\r\n        this.txt_diamonds = this.find(\"txt_diamonds\")\r\n        this.txt_diamonds.string = \"\"\r\n        this.txt_roomCard = this.find(\"txt_roomCard\")\r\n        this.txt_roomCard.string = \"\"\r\n\r\n        this.initListener()\r\n        cc.musicMgr.playLobbyBgm()\r\n        this.updatePlayerInfo()\r\n        this.requestNotice()\r\n        this.handleExamine()\r\n    },\r\n\r\n    initListener: function () {\r\n        cc.eventMgr.addEvent(\"updatePlayerInfo\", this.updatePlayerInfo, this)\r\n        cc.eventMgr.addEvent(\"requestResultData\", this.requestResultData, this)\r\n        //进入后台 \r\n        this.eventHideListener = cc.eventManager.addCustomListener(cc.game.EVENT_HIDE, function (event) {\r\n            cc.log(\"大厅进入后台\")\r\n        }.bind(this));\r\n        // //恢复显示 \r\n        this.eventShowListener = cc.eventManager.addCustomListener(cc.game.EVENT_SHOW, function (event) {\r\n            cc.log(\"大厅进入前台\")\r\n            cc.netMgr.onAppFront()\r\n        }.bind(this));\r\n    },\r\n\r\n    onDestroy: function () {\r\n        this._super()\r\n        cc.eventMgr.removeEvent(\"updatePlayerInfo\", this.updatePlayerInfo)\r\n        cc.eventMgr.removeEvent(\"requestResultData\", this.requestResultData)\r\n        cc.eventManager.removeListener(this.eventHideListener)\r\n        cc.eventManager.removeListener(this.eventShowListener)\r\n    },\r\n\r\n    // init: function () {\r\n    //     //初始化\r\n    //     if (!isInit) {\r\n    //         isInit = true\r\n    //         cc.netMgr = new NetMgr()\r\n    //         cc.netMgr.initData()\r\n    //         cc.eventMgr = new EventMgr()\r\n    //         cc.resMgr = new ResMgr()\r\n    //         cc.resMgr.init()\r\n    //         cc.res = cc.resMgr.resList\r\n\r\n    //         this.login()\r\n    //     }\r\n    // },\r\n\r\n    update: function () {\r\n        cc.netMgr.handleData()\r\n    },\r\n\r\n    login: function () {\r\n        cc.sceneNode.js.showLoadingView()\r\n        //如果不是通过丁丁平台登录的发这个协议模拟登录\r\n        if (\"\" == gUserData.dingdingData.uToken) {\r\n            this.requestValidate()\r\n        }\r\n        else {\r\n            this.loginFunc()\r\n        }\r\n\r\n    },\r\n\r\n    requestNotice: function () {\r\n        http.sendRequest(\"/game/notices\", {game_id : 1}, function (ret) {\r\n            cc.log(\"公告\", ret)\r\n            cc.netMgr.exec(ret, function () {\r\n                var list = ret.data.items\r\n                var view = this.openView(\"prefabs/notice/noticeView\")\r\n                view.setData(list)\r\n                view.hide()\r\n                for (var i = 0; i < list.length; i++) {\r\n                    var data = list[i]\r\n                    if (1 == data.pop_up) {\r\n                        var prefab = cc.res[\"prefabs/notice/noticePopView\"]\r\n                        var view = cc.instantiate(prefab)\r\n                        view.parent = this.node\r\n                        view.js = view._components[0]\r\n                        view.js.setData(data)\r\n                        view.js.show()\r\n                        \r\n                    }\r\n                }\r\n            }.bind(this))\r\n        }.bind(this))\r\n    },\r\n\r\n    requestValidate: function () {\r\n        var http = require(\"Http\");\r\n        var msg = { telephone: gUserData.uid.toString(), password: gUserData.password, system: 1, version: \"\" }\r\n        http.sendRequest(\"/game/login\", msg, function (ret, status) {\r\n            if (ret.data) {\r\n                gUserData.uid = ret.data.user_id\r\n                gUserData.dingdingData.uToken = ret.data.auth_key\r\n            }\r\n            this.loginFunc()\r\n        }.bind(this))\r\n    },\r\n\r\n    loginFunc: function () {\r\n        cc.log(\"请求登录\", gHost)\r\n        cc.netMgr.login(function (socket, code) {\r\n            if (!socket) {\r\n                cc.common.showMsgBox({ type: 1, msg: Code.getCodeName(code) })\r\n                //关闭长链接\r\n                cc.log(\"关闭长链接\")\r\n                cc.netMgr.close(false);\r\n            } else {\r\n                cc.log(\"WS验证成功\")\r\n\r\n                var http = require(\"Http\")\r\n                var data = { uid: gUserData.uid }\r\n                // cc.sceneNode.js.showLoadingView()\r\n                http.sendRequest(\"/game/room_info\", data, function (ret) {\r\n                    cc.log(ret)\r\n                    //当牌局已经结束的时候重连\r\n                    if (\"GameScene\" == cc.director.getScene()._name && ret.code == Code.ROOM_PLAYER_NOT_IN_ROOM) {\r\n                        cc.director.loadScene(\"LobbyScene\")\r\n                    }\r\n                    cc.log(JSON.stringify(ret))\r\n                    if (ret.code == Code.ROOM_PLAYER_NOT_IN_ROOM) {\r\n                        cc.sceneNode.js.hideLoadingView()\r\n                        cc.log(\"房间ID\", gUserData.dingdingData.roomId, typeof (gUserData.dingdingData.roomId))\r\n                        //test\r\n                        // this.requestFindRoom(1000116)\r\n                        if (gUserData.dingdingData.roomId) {\r\n                            this.requestFindRoom(gUserData.dingdingData.roomId)\r\n                        }\r\n                    }\r\n                    cc.netMgr.exec(ret, function () {\r\n                        // gUserData.roomInfo = ret\r\n                        gUserData.roomInfo = ret.room_info\r\n                        cc.sceneNode.js.showLoadingView()\r\n                        cc.director.loadScene(\"GameScene\")\r\n                    }.bind(this))\r\n                }.bind(this));\r\n\r\n                // this.updatePlayerInfo()\r\n                cc.eventMgr.emit(\"updatePlayerInfo\")\r\n            }\r\n        }.bind(this))\r\n    },\r\n\r\n    start: function () {\r\n        this._super()\r\n    },\r\n\r\n    //群链接查询房间\r\n    requestFindRoom: function (roomId) {\r\n        http.sendRequest(\"/game/find_room_by_rid\", { rid: roomId }, function (ret) {\r\n            cc.log(ret)\r\n            // cc.netMgr.exec(ret, function () {\r\n            //     //先查询房间信息再让用户选择加不加入\r\n            //     var roomInfoView = cc.sceneNode.js.openView(\"prefabs/joinRoom/RoomInfoView\")\r\n            //     roomInfoView.setData(clone(ret))\r\n            // }.bind(this))\r\n            if (ret.code == Code.OK) {\r\n                //先查询房间信息再让用户选择加不加入\r\n                var roomInfoView = cc.sceneNode.js.openView(\"prefabs/joinRoom/RoomInfoView\")\r\n                roomInfoView.setData(clone(ret))\r\n            }\r\n            else {\r\n                //重复提示不显示\r\n                if (cc.common.isRepetitionBar(ret.code)) {\r\n                    return\r\n                }\r\n                //浏览器显示全部信息，方便调试\r\n                if (cc.sys.isBrowser) {\r\n                    cc.common.showMsgBox({ type: 1, msg: Code.getCodeName(ret.code), codeNumber: ret.code })\r\n                }\r\n                //真机显示部分信息，策划的需求\r\n                else if (Code.isCanShow(ret.code)) {\r\n                    if (1006 == ret.code) {\r\n                        cc.common.showMsgBox({ type: 1, msg: \"房间已解散\", codeNumber: ret.code })\r\n                    }\r\n                    else {\r\n                        cc.common.showMsgBox({ type: 1, msg: Code.getCodeName(ret.code), codeNumber: ret.code })\r\n                    }\r\n                }\r\n            }\r\n        }.bind(this))\r\n    },\r\n\r\n    updatePlayerInfo: function () {\r\n        cc.netMgr.request(\"user_base_info\", { uid: gUserData.uid }, function (ret) {\r\n            cc.netMgr.exec(ret, function () {\r\n                cc.log(\"更新个人信息\", ret.user_base_info)\r\n                gUserData.playerInfo = ret.user_base_info\r\n                this.txtUid.string = i18n.dd_no + \"：\" + gUserData.playerInfo.ding_no\r\n                this.txtName.string = gUserData.playerInfo.name\r\n                this.txt_diamonds.string = gUserData.playerInfo.diamonds\r\n                this.txt_roomCard.string = gUserData.playerInfo.room_card\r\n                cc.resMgr.loadNetUrl(this.find(\"imgIcon\"), gUserData.playerInfo.avatar)\r\n                cc.eventMgr.emit(\"updatePlayerInfoSuccess\")\r\n            }.bind(this))\r\n        }.bind(this))\r\n    },\r\n\r\n    //创建房间\r\n    onBtnCreateRoom: function () {\r\n        if (!this.isForbidGame()) {\r\n            this.openView(\"prefabs/createRoom/CreateRoomView\")\r\n        }\r\n    },\r\n    //加入房间\r\n    onBtnJoinRoom: function () {\r\n        if (!this.isForbidGame()) {\r\n            this.openView(\"prefabs/joinRoom/JoinRoomView\")\r\n        }\r\n        else {\r\n            cc.common.showMsgBox({\r\n                type: 2, msg: \"游戏停止运营\", okCb: function () {\r\n                    GameToAppHelper.ExitGame()\r\n                }\r\n            })\r\n        }\r\n    },\r\n\r\n    //检查屏蔽游戏，两个平台都屏蔽时，不能游戏\r\n    isForbidGame: function () {\r\n        //IOS\r\n        http.sendRequest(\"/game/fetch_shields\", { system: 1 }, function (ret, status) {\r\n            cc.log(ret)\r\n            if (1 == ret.disGame_baijiale) {\r\n                return false\r\n            }\r\n            //android\r\n            http.sendRequest(\"/game/fetch_shields\", { system: 2 }, function (ret, status) {\r\n                cc.log(ret)\r\n            if (1 == ret.disGame_baijiale) {\r\n                return false\r\n            }\r\n            else\r\n                return true;\r\n            }.bind(this))\r\n        }.bind(this))\r\n    },\r\n\r\n    //其它\r\n    //返回\r\n    onBTNBack: function () {\r\n        //test\r\n        //cc.netMgr.onAppBack()\r\n        GameToAppHelper.ExitGame()\r\n    },\r\n\r\n    //设置\r\n    onBtnSetting: function () {\r\n        // cc.log(cc.res)\r\n        var view = this.openView(\"prefabs/settingView/SettingView\")\r\n        view.find(\"btn_jrfj\").active = false\r\n    },\r\n\r\n    //商店\r\n    onBtnMall: function (eventTouch, param) {\r\n        this.openView(\"prefabs/mall/mallView\", null, Number(param))\r\n    },\r\n\r\n    //战绩\r\n    showRecordView: function () {\r\n        this.openView(\"prefabs/battleRecord/TotalBattleRecordView\", this.find(\"totalBattleRecordNode\").node)\r\n    },\r\n\r\n    showRuleView: function () {\r\n        this.openView(\"prefabs/ruleView/RuleView\")\r\n    },\r\n\r\n    onBtnShare: function () {\r\n        var view = this.openView(\"prefabs/share/ShareView\")\r\n    },\r\n\r\n    onBtnNotices: function () {\r\n        var view = this.openView(\"prefabs/notice/noticeView\")\r\n    },\r\n\r\n    requestResultData: function () {\r\n        cc.log(\"请求上一局的结算数据\")\r\n        var data = { page: 1, uid: gUserData.uid }\r\n        http.sendRequest(\"/game/room_record\", data, function (ret) {\r\n            cc.log(ret)\r\n            cc.netMgr.exec(ret, function () {\r\n                var lastResultData = ret.room_record_info_list[0]\r\n                var view = this.openView(\"prefabs/totalResult/TotalResultView\", this.find(\"totalResultNode\").node)\r\n                view.setTotalBattleRecordData(lastResultData)\r\n            }.bind(this))\r\n        }.bind(this))\r\n    },\r\n\r\n    //处理审核\r\n    handleExamine: function () {\r\n        if (!IS_EXAMINE) {\r\n            return\r\n        }\r\n        // this.find(\"btnShop\").active = false\r\n        this.find(\"btnShare\").active = false\r\n        this.find(\"btnLog\").active = false\r\n    },\r\n\r\n});\r\n"]}