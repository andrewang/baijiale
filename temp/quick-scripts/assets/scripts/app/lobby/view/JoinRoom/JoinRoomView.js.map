{"version":3,"sources":["JoinRoomView.js"],"names":["BaseView","require","http","Code","cc","Class","extends","properties","moduleName","override","default","visible","onLoad","_super","txtRoomId","find","string","layoutRoomId","i","onEnable","onBtnClear","IS_DEBUG","sys","isBrowser","mgr","requestJoin","JSON","parse","localStorage","getItem","inputNum","event","length","target","name","showRoomId","reqCheckRoomInfo","num","substring","log","roomId","self","sendRequest","room_num","ret","code","OK","netMgr","exec","rid","roomInfoView","sceneNode","js","openView","setData","clone","hide","bind","onBtnDelete"],"mappings":"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","file":"JoinRoomView.js","sourceRoot":"../../../../../../../../assets/scripts/app/lobby/view/JoinRoom","sourcesContent":["var BaseView = require(\"BaseView\")\nvar http = require(\"Http\")\nvar Code = require(\"Code\");\n\ncc.Class({\n    extends: BaseView,\n\n    properties: {\n        moduleName : {\n            override: true,\n            default: \"JoinRoom\",\n            // type: 'String',\n            visible: false,\n        },\n        // txtRoomId : cc.Label,\n    },\n\n    onLoad: function () {\n        this._super()\n\n        this.txtRoomId = this.find(\"txtRoomId\")\n        this.txtRoomId.string = \"\"\n        this.layoutRoomId = this.find(\"layoutRoomId\")\n        // cc.eventMgr.emit(\"test\", {bbb:\"aaa\", ccc:\"dddd\"})\n        for (var i = 1; i <= 6; i++) {\n            this.layoutRoomId[i].string = \"\"\n        }\n    }, \n\n    onEnable: function () {\n        this._super()\n        this.onBtnClear()\n        //this.txtRoomId.string = \"\"\n\n        //自动加入房间，方便调试\n        // if (IS_DEBUG && (cc.sys.isBrowser || cc.sys.MACOS == cc.sys.platform)) {\n        if (IS_DEBUG && cc.sys.isBrowser) {\n            // cc.log(JSON.parse(cc.sys.localStorage.getItem('roomId')))\n            this.mgr.requestJoin(JSON.parse(cc.sys.localStorage.getItem('roomId')))\n        }\n    },\n\n    inputNum: function (event) {\n        if (this.txtRoomId.string.length == 6) {\n            return\n        }\n        this.txtRoomId.string += event.target.name\n        this.showRoomId()\n        //加入房间\n        if (this.txtRoomId.string.length == 6) {\n            this.reqCheckRoomInfo(this.txtRoomId.string)\n        }\n    },\n\n    showRoomId: function () {\n        for (var i = 1; i <= 6; i++) {\n            this.layoutRoomId[i].string = \"\"\n        }\n        for (var i = 1; i <= this.txtRoomId.string.length; i++) {\n            var num = this.txtRoomId.string.substring(i - 1, i)\n            cc.log( this.layoutRoomId)\n            this.layoutRoomId[i].string = num\n            // this.layoutRoomId.getChildByName(i).getComponent(cc.Label).string = num\n        }\n    },\n\n    reqCheckRoomInfo: function (roomId) {\n        var self = this\n        http.sendRequest(\"/game/find_room\", {room_num : roomId}, function (ret) {\n            cc.log(ret)\n            //房间号错误，清空\n            if (ret.code != Code.OK) {\n                this.onBtnClear()\n            } \n            cc.netMgr.exec(ret, function () {\n                cc.log(ret)\n                //调试直接加入\n                // if (IS_DEBUG && (cc.sys.isBrowser || cc.sys.MACOS == cc.sys.platform)) {\n                if (IS_DEBUG && cc.sys.isBrowser) {\n                    self.mgr.requestJoin(ret.rid)\n                }\n                //先查询房间信息再让用户选择加不加入\n                else {\n                    var roomInfoView = cc.sceneNode.js.openView(\"prefabs/joinRoom/RoomInfoView\")\n                    roomInfoView.setData(clone(ret))\n                    this.onBtnClear()\n                    this.hide()\n                }\n            }.bind(this))\n        }.bind(this))\n    },\n\n    onBtnDelete: function () {\n        this.txtRoomId.string = this.txtRoomId.string.substring(0, this.txtRoomId.string.length - 1)\n        this.showRoomId()\n    },\n\n    onBtnClear: function () {\n        this.txtRoomId.string = \"\"\n        this.showRoomId()\n    },\n});\n"]}