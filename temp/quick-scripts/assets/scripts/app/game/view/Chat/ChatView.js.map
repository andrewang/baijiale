{"version":3,"sources":["ChatView.js"],"names":["BaseView","require","ChatConfig","record","gmList","push","cc","Class","extends","properties","onLoad","_super","self","i","find","on","event","str","target","_name","_children","getComponent","Label","string","voiceStr","chatStage","toString","gameMgr","_myData","user_base_info","gender","reqChat","type","words","playVoice","log","musicMgr","playEffect","onEnable","y","replaceCommonLanguage","Number","showEmoji","active","showUsefulLangue","onBtnSend","chatstr","isGm","handleGm","data","netMgr","request","ret","exec","bind","hide","stage","chatList","puTong","chaozhou","jieyang","shantou","newsList","index","element","nodeName","height","length","IS_DEBUG","indexOf","getInstance","testPlay","match","sex","downloadVoice"],"mappings":"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","file":"ChatView.js","sourceRoot":"../../../../../../../../assets/scripts/app/game/view/Chat","sourcesContent":["var BaseView = require(\"BaseView\")\nvar ChatConfig = require(\"ChatConfig\")\nvar record = require(\"RecordMgr\")\nvar gmList = []\ngmList.push(\"playVoice\")\ngmList.push(\"test\")\ngmList.push(\"#sex\")\ngmList.push(\"downloadVoice\")\n\ncc.Class({\n    extends: BaseView,\n\n    properties: {\n\n    },\n\n    onLoad: function () {\n        this._super()\n\n        var self = this\n        for (var i = 1; i <= 13; i++) {\n            this.find(i).on('click', function (event) {\n                // cc.log(event.target._name)\n                var str = self.find(event.target._name)._children[0].getComponent(cc.Label).string\n                // str = str.substr(2) //前面两个字符不要了\n                var voiceStr = ChatConfig.chatStage.toString() + cc.gameMgr._myData.user_base_info.gender.toString() + str\n                self.reqChat({ type: 1, words: voiceStr })\n                var playVoice = \"placeVoice/\" + voiceStr + \".mp3\"\n                cc.log(\"playVoice: \", playVoice)\n                cc.musicMgr.playEffect(playVoice)\n            })\n        }\n\n        for (var i = 0; i <= 31; i++) {\n            this.find(\"bq_\" + i).on('click', function (event) {\n                // cc.log(event.target._name)\n                self.reqChat({ type: 3, words: event.target._name })\n            })\n        }\n    },\n\n    onEnable: function () {\n        cc.log(\"onEnable: ChatView\", ChatConfig.chatStage)\n        this.find(\"content_1\").y = 235\n        this.replaceCommonLanguage(Number(ChatConfig.chatStage))\n    },\n\n    showEmoji: function () {\n        this.find(\"page_1\").active = false\n        this.find(\"page_2\").active = true\n    },\n\n    showUsefulLangue: function () {\n        this.find(\"page_2\").active = false\n        this.find(\"page_1\").active = true\n    },\n\n    onBtnSend: function () {\n        // cc.log(this.find(\"txtContent\").string)\n        let chatstr = this.find(\"txtContent\").string\n        if (chatstr == \"\")\n            return\n        if (this.isGm(chatstr)) {\n            this.handleGm(chatstr)\n            return\n        }\n        this.reqChat({ type: 2, words: chatstr })\n    },\n\n    //发送聊天\n    reqChat: function (data) {\n        cc.netMgr.request(\"room_chat\", data, function (ret) {\n            cc.netMgr.exec(ret, function () {\n                this.find(\"txtContent\").string = \"\"\n            }.bind(this))\n        }.bind(this))\n        this.hide()\n        // this.GMCommond(data)\n        // this.showBubbleTest(data)\n    },\n\n    // GMCommond: function (data) {\n    //     if (data.words.match(\"#\"))      //GM指令，更改性别，供给测试\n    //     {\n    //         cc.log(\"clientGMBegin\")\n    //         if (data.words.match(\"sex\")) {\n    //             var sex = data.words.match(\"1\") ? 1 : 2\n    //             cc.log(\"clientGMBegin   sex\", sex)\n    //             cc.gameMgr._myData.user_base_info.gender = sex\n    //         }\n    //     }\n    // },\n\n    // showBubbleTest: function (data) {\n    //     var self = this\n    //     this.find(\"test\").active = true\n    //     this.find(\"test\").stopAllActions()\n    //     this.find(\"test\").runAction(cc.sequence(cc.delayTime(2), cc.callFunc(function () {\n    //         self.find(\"test\").active = false\n    //     })))\n\n    //     this.find(\"testLabel\").node.active = false\n    //     this.find(\"testEmoji\").node.active = false\n    //     //表情\n    //     if (3 == data.type) {\n    //         this.find(\"testEmoji\").node.active = true\n    //         this.find(\"test\").setContentSize({ width: 94, height: 84 })\n    //         // this.find(\"testEmoji\").spriteFrame = this.find(data.words).getComponent(cc.Sprite).spriteFrame\n    //         cc.resMgr.updateSprite(this.find(\"testEmoji\"), \"expression/\" + data.words)\n    //     }\n    //     else if (2 == data.type) {\n    //         this.find(\"testEmoji\").node.active = true\n    //         this.find(\"test\").setContentSize({ width: 94, height: 84 })\n    //         record.getInstance().downloadVoice(data.words)\n    //     }\n    //     else {\n    //         this.find(\"testLabel\").node.active = true\n    //         this.find(\"testLabel\").string = data.words\n    //         var size = this.find(\"testLabel\").node.getContentSize()\n    //         this.find(\"test\").setContentSize({ width: size.width + 30, height: size.height + 20 })\n    //     }\n    // },\n\n    replaceCommonLanguage: function (stage) {\n        for (let i = 1; i <= 13; i++) {\n            this.find(i).active = false\n        }\n        var chatList\n        switch (stage) {\n            case 1:\n                chatList = ChatConfig.puTong\n                break;\n            case 2:\n                chatList = ChatConfig.chaozhou\n                break;\n            case 3:\n                chatList = ChatConfig.jieyang\n                break;\n            case 4:\n                chatList = ChatConfig.shantou\n                break;\n            default:\n                cc.log(\"ERROR : ChatView.js replaceCommonLanguage() stage = \", stage)\n                break;\n        }\n        var newsList = chatList[cc.gameMgr._myData.user_base_info.gender - 1]\n        for (let index in newsList) {\n            const element = newsList[index];\n            let nodeName = (Number(index) + 1).toString()\n            this.find(nodeName)._children[0].getComponent(cc.Label).string = element\n            this.find(nodeName).active = true\n        }\n        this.find(\"content_1\").height = 71 * newsList.length\n    },\n\n    isGm: function (str) {\n        for (var i = 0; i < gmList.length; i++) {\n            var element = gmList[i];\n            if (IS_DEBUG && (element == str || -1 != str.indexOf(element))) {\n                return true\n            }\n        }\n        return false\n    },\n\n    handleGm: function (str) {\n        if (\"test\" == str) {\n            cc.netMgr.request(\"room_chat\", { type: 4, words: \"http://192.168.31.216:8203/voice?file=27811544271521776266\" }, function (ret) {\n\n            }.bind(this))\n        }\n        else if (\"test\" == str) {\n            record.getInstance().testPlay()\n        }\n        else if (str.match(\"#sex\")) {\n            if (str.match(\"#\"))      //GM指令，更改性别，供给测试\n            {\n                cc.log(\"clientGMBegin\")\n                if (str.match(\"sex\")) {\n                    var sex = str.match(\"1\") ? 1 : 2\n                    cc.log(\"clientGMBegin   sex\", sex)\n                    cc.gameMgr._myData.user_base_info.gender = sex\n                }\n            }\n        }\n        else if (\"downloadVoice\" == str) {\n            // record.getInstance().downloadVoice(\"http://120.78.177.52:8203/voice?file=19691557791521768277\")\n            // record.getInstance().downloadVoice(\"http://192.168.31.216:8203/voice?file=27811544271521776266\")\n            record.getInstance().downloadVoice()\n        }\n    },\n\n\n});\n"]}