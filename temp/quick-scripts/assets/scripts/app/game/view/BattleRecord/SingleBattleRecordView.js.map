{"version":3,"sources":["SingleBattleRecordView.js"],"names":["BaseView","require","http","serverRoomDesc","cc","Class","extends","properties","onLoad","_super","svLayout","find","lock","on","reqGameRecord","rid","setData","data","string","room_num","gUserData","roomInfo","room_setup_info","low_bet","hig_bet","max_inning_num","newDate","Date","setTime","open_room_time","formatDate","self","sendRequest","page","iPage","uid","ret","log","netMgr","exec","addItem","inning_record_info_list","reqGameRoomData","index","room_record_info_list","Data","i","length","item","instantiate","res","js","getComponent","parent","node","owner_base_info","seat_info_list","totalHeight","getContentSize","height","spacingY","setTimeout","setContentSize","width","bind","show","removeAllChildren"],"mappings":"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","file":"SingleBattleRecordView.js","sourceRoot":"../../../../../../../../assets/scripts/app/game/view/BattleRecord","sourcesContent":["var BaseView = require(\"BaseView\")\nvar http = require(\"Http\")\nvar serverRoomDesc = require(\"JoinRoomConfig\").serverRoomDesc\n\ncc.Class({\n    extends: BaseView,\n\n    properties: {\n\n    },\n\n    onLoad: function () {\n        this._super()\n        this.svLayout = this.find(\"svLayout\")\n        this.lock = true\n        this.find(\"scrollview\").on('scroll-to-bottom', function () {\n            if (this.lock)\n            {\n                this.lock = false\n                this.reqGameRecord(this.rid)\n            }\n        }, this)\n    },\n\n    setData: function (data) {\n        this.find(\"txtRoomId\").string = \"房间号:\" + data.room_num\n        // this.find(\"txtYazhu\").string = \"最低-最高:\" + serverRoomDesc[\"bet_limit_type\"][data.bet_limit_type]\n        this.find(\"txtYazhu\").string = \"最低-最高:\" + gUserData.roomInfo.room_setup_info.low_bet + \"-\" + gUserData.roomInfo.room_setup_info.hig_bet\n        // this.find(\"txtJushu\").string = \"局数:\" + serverRoomDesc[\"inning_limit_type\"][data.inning_limit_type]\n        this.find(\"txtJushu\").string = \"局数:\" + data.max_inning_num\n        var newDate = new Date()\n        newDate.setTime(data.open_room_time * 1000)\n        this.find(\"txtTime\").string = formatDate(newDate)\n    },\n\n    reqGameRecord: function (rid) {\n        this.rid = rid\n        var self = this\n        http.sendRequest(\"/game/inning_record\", {rid : this.rid, page : this.iPage, uid: gUserData.uid}, function (ret) {\n            cc.log(ret)\n            cc.netMgr.exec(ret, function () {\n                self.addItem(ret.inning_record_info_list)\n                self.iPage ++\n                self.lock = true\n            })\n        })\n    },\n\n    reqGameRoomData: function () {\n        var self = this\n        var data = { page: 1, uid: gUserData.uid }\n        http.sendRequest(\"/game/room_record\", data, function (ret) {\n            cc.log(ret)\n            cc.netMgr.exec(ret, function () {\n                for (let index in ret.room_record_info_list)\n                {\n                    let Data = ret.room_record_info_list[index]\n                    if (self.rid == Data.rid)\n                    {\n                        self.setData(Data)\n                        return\n                    }\n                }\n            })\n        })\n    },\n\n    addItem: function (inning_record_info_list) {\n        for (var i = 0; i < inning_record_info_list.length; i++) {\n            var data = inning_record_info_list[i]\n            var item = cc.instantiate(cc.res[\"prefabs/battleRecord/SingleBattleRecordItem\"])\n            item.js = item.getComponent(\"SingleBattleRecordItem\")\n            item.parent = this.svLayout.node\n            // item.js.owner_uid = this.owner_uid\n            item.js.owner_base_info = this.owner_base_info\n            item.js.seat_info_list = this.seat_info_list\n            item.js.setData(data)\n            this.totalHeight += (item.getContentSize().height + this.svLayout.spacingY)\n        }\n        // this.find(\"sv_content\").setContentSize({ width: 960, height: this.totalHeight })\n        setTimeout(function () {\n            this.find(\"sv_content\").setContentSize({ width: 960, height: this.svLayout.node.getContentSize().height})\n        }.bind(this), 200)\n    },\n\n    show: function () {\n        this._super()\n        this.svLayout.node.removeAllChildren()\n        this.totalHeight = 0\n        this.iPage = 1\n    },\n\n});\n"]}