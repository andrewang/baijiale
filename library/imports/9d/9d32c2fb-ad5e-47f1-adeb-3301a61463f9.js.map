{"version":3,"sources":["../../../../../../assets/scripts/app/login/assets/scripts/app/login/LoginScene.js"],"names":["BaseScene","require","EventMgr","NetMgr","ResMgr","MusicMgr","GameToAppHelper","localConfig","cc","appToGameHelper","Class","extends","properties","moduleName","override","default","visible","onLoad","_super","find","node","active","eventMgr","sys","isNative","Device","setKeepScreenOn","string","uid","password","data","getGameEnterInitData","JSON","parse","error","log","gUserData","dingdingData","setExamine","gameData","isHide","serverType","gHost","gHostDev","gHostTest","gHostPro","init","loadServerSelect","login","Number","saveServerSelect","children","_children","i","length","toggle","getComponent","Toggle","isChecked","localStorage","setItem","_name","connectServer","getItem","onDestroy","start","onBtnUpdate","self","netMgr","initData","resMgr","res","resList","musicMgr"],"mappings":";;;;;;AAAA,IAAIA,YAAYC,QAAQ,WAAR,CAAhB;AACA,IAAIC,WAAWD,QAAQ,UAAR,CAAf;AACAA,QAAQ,QAAR;AACA,IAAIE,SAASF,QAAQ,QAAR,CAAb;AACA,IAAIG,SAASH,QAAQ,QAAR,CAAb;AACA,IAAII,WAAWJ,QAAQ,UAAR,CAAf;AACA,IAAIK,kBAAkBL,QAAQ,iBAAR,CAAtB;AACA,IAAIM,cAAcN,QAAQ,aAAR,CAAlB;AACAO,GAAGC,eAAH,GAAqBR,QAAQ,iBAAR,CAArB;;AAEAO,GAAGE,KAAH,CAAS;AACLC,aAASX,SADJ;AAELY,gBAAY;AACRC,oBAAY;AACRC,sBAAU,IADF;AAERC,qBAAS,OAFD;AAGRC,qBAAS;AAHD;AADJ,KAFP;;AAULC,YAAQ,kBAAY;AAChB,aAAKC,MAAL;;AAEA,aAAKC,IAAL,CAAU,eAAV,EAA2BC,IAA3B,CAAgCC,MAAhC,GAAyC,KAAzC;;AAEAb,WAAGc,QAAH,GAAc,IAAIpB,QAAJ,EAAd;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA,YAAIM,GAAGe,GAAH,CAAOC,QAAX,EAAqB;AACjBhB,eAAGiB,MAAH,CAAUC,eAAV,CAA0B,IAA1B;AACH;AACD,aAAKP,IAAL,CAAU,aAAV,EAAyBQ,MAAzB,GAAkCpB,YAAYqB,GAA9C;AACA,aAAKT,IAAL,CAAU,UAAV,EAAsBQ,MAAtB,GAA+BpB,YAAYsB,QAA3C;AACA,YAAIC,OAAO,IAAX;AACA;AACA;AACA,YAAI;AACAA,mBAAOxB,gBAAgByB,oBAAhB,EAAP;AACAD,mBAAOE,KAAKC,KAAL,CAAWH,IAAX,CAAP;AACH,SAHD,CAGE,OAAOI,KAAP,EAAc,CAEf;AACD,YAAIJ,IAAJ,EAAU;AACNtB,eAAG2B,GAAH,CAAO,0BAAP,EAAmCL,IAAnC;AACAM,sBAAUR,GAAV,GAAgBE,KAAKF,GAArB;AACAQ,sBAAUC,YAAV,GAAyBP,IAAzB;AACAQ,uBAAWF,UAAUC,YAAV,CAAuBE,QAAvB,CAAgCC,MAA3C;AACA;AACA,gBAAIC,aAAaX,KAAKW,UAAtB;AACA,gBAAI,SAASA,UAAb,EAAyB;AACrBC,wBAAQC,QAAR;AACH,aAFD,MAGK,IAAI,UAAUF,UAAd,EAA0B;AAC3BC,wBAAQE,SAAR;AACH,aAFI,MAGA,IAAI,SAASH,UAAb,EAAyB;AAC1BC,wBAAQG,QAAR;AACH;AACDrC,eAAG2B,GAAH,CAAO,aAAP,EAAsBM,UAAtB,EAAkCC,KAAlC;AACA,iBAAKI,IAAL;AACA;AACH,SAnBD,MAoBK;AACD,iBAAKC,gBAAL;AACH;AACD;AACA;AACA;AACA;AACA;;;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;AAGA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACH,KAvMI;;AAyMLC,WAAO,iBAAY;AACf,aAAKF,IAAL;AACAV,kBAAUR,GAAV,GAAgBqB,OAAO,KAAK9B,IAAL,CAAU,aAAV,EAAyBQ,MAAhC,CAAhB;AACAS,kBAAUP,QAAV,GAAqB,KAAKV,IAAL,CAAU,UAAV,EAAsBQ,MAA3C;AACA;;AAEA,aAAKuB,gBAAL;;AAEA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACH,KAjOI;;AAmOLA,sBAAkB,4BAAY;AAC1B,YAAIC,WAAW,KAAKhC,IAAL,CAAU,qBAAV,EAAiCiC,SAAhD;AACA,aAAK,IAAIC,IAAI,CAAb,EAAgBA,IAAIF,SAASG,MAA7B,EAAqCD,GAArC,EAA0C;AACtC,gBAAIE,SAASJ,SAASE,CAAT,EAAYG,YAAZ,CAAyBhD,GAAGiD,MAA5B,CAAb;AACA,gBAAIF,OAAOG,SAAX,EAAsB;AAClBlD,mBAAGe,GAAH,CAAOoC,YAAP,CAAoBC,OAApB,CAA4B,eAA5B,EAA6CT,SAASE,CAAT,EAAYQ,KAAzD;AACA;AACH;AACJ;AACD,YAAIC,gBAAgBtD,GAAGe,GAAH,CAAOoC,YAAP,CAAoBI,OAApB,CAA4B,eAA5B,CAApB;AACA,YAAID,iBAAiB,SAArB,EAAgC;AAC5BpB,oBAAQC,QAAR;AACH,SAFD,MAGK,IAAImB,iBAAiB,SAArB,EAAgC;AACjCpB,oBAAQE,SAAR;AACH,SAFI,MAGA,IAAIkB,iBAAiB,SAArB,EAAgC;AACjCpB,oBAAQG,QAAR;AACH;AACJ,KAtPI;;AAwPLE,sBAAkB,4BAAY;AAC1BvC,WAAG2B,GAAH,CAAO,sBAAP;AACA,YAAI2B,gBAAgBtD,GAAGe,GAAH,CAAOoC,YAAP,CAAoBI,OAApB,CAA4B,eAA5B,CAApB;AACA,YAAIZ,WAAW,KAAKhC,IAAL,CAAU,qBAAV,EAAiCiC,SAAhD;AACA,aAAK,IAAIC,IAAI,CAAb,EAAgBA,IAAIF,SAASG,MAA7B,EAAqCD,GAArC,EAA0C;AACtC,gBAAIE,SAASJ,SAASE,CAAT,EAAYG,YAAZ,CAAyBhD,GAAGiD,MAA5B,CAAb;AACAF,mBAAOG,SAAP,GAAmB,KAAnB;AACH;AACD,YAAII,aAAJ,EAAmB;AACf,iBAAK3C,IAAL,CAAU2C,aAAV,EAAyBN,YAAzB,CAAsChD,GAAGiD,MAAzC,EAAiDC,SAAjD,GAA6D,IAA7D;AACH,SAFD,MAGK;AACDhB,oBAAQE,SAAR,CADC,CACiB;AAClB,iBAAKzB,IAAL,CAAU,SAAV,EAAqBqC,YAArB,CAAkChD,GAAGiD,MAArC,EAA6CC,SAA7C,GAAyD,IAAzD;AACH;AACJ,KAvQI;;AAyQLM,eAAW,qBAAY;AACnB;AACH,KA3QI;;AA6QLC,WAAO,iBAAY;AACf,aAAK/C,MAAL;AACH,KA/QI;;AAiRLgD,iBAAa,uBAAY;AACrB,aAAK/C,IAAL,CAAU,eAAV,EAA2BC,IAA3B,CAAgCC,MAAhC,GAAyC,CAAC,KAAKF,IAAL,CAAU,eAAV,EAA2BC,IAA3B,CAAgCC,MAA1E;AACH,KAnRI;;AAqRLyB,UAAM,gBAAY;AACd,YAAIqB,OAAO,IAAX;AACA3D,WAAG4D,MAAH,GAAY,IAAIjE,MAAJ,EAAZ;AACAK,WAAG4D,MAAH,CAAUC,QAAV;AACA7D,WAAGc,QAAH,GAAc,IAAIpB,QAAJ,EAAd;AACAM,WAAG8D,MAAH,GAAY,IAAIlE,MAAJ,EAAZ;AACAI,WAAG8D,MAAH,CAAUxB,IAAV;AACAtC,WAAG+D,GAAH,GAAS/D,GAAG8D,MAAH,CAAUE,OAAnB;AACAhE,WAAGiE,QAAH,GAAc,IAAIpE,QAAJ,EAAd;AACH;;AA9RI,CAAT","file":"LoginScene.js","sourceRoot":"../../../../../../assets/scripts/app/login","sourcesContent":["var BaseScene = require(\"BaseScene\")\r\nvar EventMgr = require(\"EventMgr\")\r\nrequire(\"LogMgr\")\r\nvar NetMgr = require(\"NetMgr\")\r\nvar ResMgr = require(\"ResMgr\")\r\nvar MusicMgr = require(\"MusicMgr\")\r\nvar GameToAppHelper = require(\"GameToAppHelper\")\r\nvar localConfig = require(\"localConfig\")\r\ncc.appToGameHelper = require(\"AppToGameHelper\")\r\n\r\ncc.Class({\r\n    extends: BaseScene,\r\n    properties: {\r\n        moduleName: {\r\n            override: true,\r\n            default: \"Login\",\r\n            visible: false,\r\n        },\r\n    },\r\n\r\n    onLoad: function () {\r\n        this._super()\r\n\r\n        this.find(\"nodeHotUpdate\").node.active = false\r\n\r\n        cc.eventMgr = new EventMgr()\r\n\r\n        // require(\"localConfig\")\r\n        // cc.log(jsb.fileUtils)\r\n        // var data = jsb.fileUtils.getDataFromFile(customHttpRequest._fileName);\r\n\r\n        // this.editAccount.string = \"1\"\r\n        // this.Canvas.editAccount.string = \"1\"\r\n        // this.uiContainer.editAccount.string = \"1\"\r\n        // this.uiContainer.Canvas.editAccount.string = \"1\"\r\n\r\n        if (cc.sys.isNative) {\r\n            cc.Device.setKeepScreenOn(true)\r\n        }\r\n        this.find(\"editAccount\").string = localConfig.uid\r\n        this.find(\"password\").string = localConfig.password\r\n        var data = null\r\n        //test data\r\n        // data = {uid : \"18018018001\", gameData : {isHide : true}, serverType : \"pro\"}\r\n        try {\r\n            data = GameToAppHelper.getGameEnterInitData()\r\n            data = JSON.parse(data)\r\n        } catch (error) {\r\n\r\n        }\r\n        if (data) {\r\n            cc.log(\"====getGameEnterInitData\", data)\r\n            gUserData.uid = data.uid\r\n            gUserData.dingdingData = data\r\n            setExamine(gUserData.dingdingData.gameData.isHide)\r\n            //应用控制连的服务器地址\r\n            var serverType = data.serverType\r\n            if (\"dev\" == serverType) {\r\n                gHost = gHostDev\r\n            }\r\n            else if (\"test\" == serverType) {\r\n                gHost = gHostTest\r\n            }\r\n            else if (\"pro\" == serverType) {\r\n                gHost = gHostPro\r\n            }\r\n            cc.log(\"应用控制连的服务器地址\", serverType, gHost)\r\n            this.init()\r\n            // cc.director.loadScene('LobbyScene')\r\n        }\r\n        else {\r\n            this.loadServerSelect()\r\n        }\r\n        // cc.log(cc.sys.localStorage.getItem('ruleData'))\r\n        // var jsonTest = JSON.parse(\"{\\\"hello\\\": 233, \\\"name\\\":bb}\")\r\n        // var jsonTest = JSON.parse(\"{\\\"a\\\"}\")\r\n        // var jsonTest = JSON.parse('[{\"CityId\":18,\"CityName\":\"西安\",\"ProvinceId\":27,\"CityOrder\":1},{\"CityId\":53,\"CityName\":\"广州\",\"ProvinceId\":27,\"CityOrder\":1}]')\r\n        // cc.log(jsonTest)\r\n\r\n\r\n        // cc.log(\"platform:\", cc.sys.platform, cc.sys.platform.MACOS == cc.sys.platform, cc.sys.platform.MACOS, cc.sys.isNative)\r\n        //路单测试\r\n        // setTimeout(function name(params) {\r\n        //     cc.loader.loadRes(\"prefabs/wayBill/WayBillView\", function (err, prefab) {\r\n        //         cc.res[\"prefabs/wayBill/WayBillView\"] = prefab\r\n        //         var view = cc.instantiate(prefab)\r\n        //         view.parent = self.node\r\n        //        view.getComponent(\"WayBillView\").test()\r\n        //     })\r\n        // }, 200)\r\n\r\n        //游戏总结算测试\r\n        // cc.loader.loadRes(\"prefabs/totalResult/TotalResultView\", function (err, prefab) {\r\n        //     cc.res[\"prefabs/totalResult/TotalResultView\"] = prefab\r\n        //     var view = self.openView(\"prefabs/totalResult/TotalResultView\")\r\n        // })\r\n\r\n        //设置\r\n        // cc.loader.loadRes(\"prefabs/settingView/SettingView\", function (err, prefab) {\r\n        //     cc.res[\"prefabs/settingView/SettingView\"] = prefab\r\n        //     var view = self.openView(\"prefabs/settingView/SettingView\")\r\n        // })\r\n\r\n        //解散房间\r\n        // cc.loader.loadRes(\"prefabs/dismissRoom/DismissRoomView\", function (err, prefab) {\r\n        //     cc.res[\"prefabs/dismissRoom/DismissRoomView\"] = prefab\r\n        //     var view = self.openView(\"prefabs/dismissRoom/DismissRoomView\")\r\n        //     view.setData()\r\n        // })\r\n\r\n        //聊天\r\n        // cc.loader.loadRes(\"prefabs/chat/ChatView\", function (err, prefab) {\r\n        //     cc.res[\"prefabs/chat/ChatView\"] = prefab\r\n        //     var view = self.openView(\"prefabs/chat/ChatView\")\r\n        // })\r\n\r\n        //战绩\r\n        // cc.resMgr.loadPrefab(\"prefabs/battleRecord/TotalBattleRecordItem\")\r\n        // setTimeout(function name(params) {\r\n        //     cc.loader.loadRes(\"prefabs/battleRecord/TotalBattleRecordView\", function (err, prefab) {\r\n        //         cc.res[\"prefabs/battleRecord/TotalBattleRecordView\"] = prefab\r\n        //         var view = self.openView(\"prefabs/battleRecord/TotalBattleRecordView\")\r\n        //     })\r\n        // }, 300)\r\n\r\n\r\n        // cc.resMgr = new ResMgr()\r\n        // cc.resMgr.init()\r\n        // cc.res = cc.resMgr.resList\r\n\r\n        //消息条\r\n        // var i = 1\r\n        // setInterval(function () {\r\n        //     cc.common.showMsgBox({ type: 1, msg: \"第\" + i + \"条信息\" })\r\n        //     i++\r\n        // }, 300)\r\n        // cc.common.showMsgBox({ type: 2, msg: \"fff水电费水电费\",  cb : function () {\r\n        //     cc.log(\"aaaaa\")\r\n        // }})\r\n\r\n        // cc.musicMgr.setVolume(0.1)\r\n        // cc.musicMgr.playEffect(\"send_card_zhuang.mp3\")\r\n\r\n        // var jipaiNode = this.find(\"jipaiNode\")\r\n        // jipaiNode.getComponent(\"ThreeDCard\").init()\r\n        // var jipaiNode2 = this.find(\"jipaiNode2\")\r\n        // jipaiNode2.getComponent(\"ThreeDCard\").init()\r\n\r\n        // var cardTest = this.find(\"cardTest\")\r\n        // cardTest.reset()\r\n        // cardTest.showBack()\r\n        // cardTest.setData({cards: 1, type : 1}, 1)\r\n        // cardTest.moveToSqueeze({x : 414, y: 6})\r\n\r\n        // this.find(\"aniXiandui\").getComponent(cc.Animation).on('stop', function () {\r\n        //     this.find(\"aniXiandui\").active = false\r\n        // },this)\r\n        // setTimeout(function () {\r\n        //     this.find(\"aniXiandui\").getComponent(cc.Animation).play()\r\n        // }.bind(this), 1000)\r\n\r\n        // var cutCtrlNode = this.find(\"cutControl\")\r\n        // cutCtrlNode.on(cc.Node.EventType.TOUCH_MOVE, function (touch) {\r\n        //     var pos = cutCtrlNode.parent.convertTouchToNodeSpaceAR(touch)\r\n        //     if (pos.x <= 240 && pos.x >= -240) {\r\n        //         cutCtrlNode.position = { x: pos.x, y: cutCtrlNode.position.y }\r\n        //         cutCtrlNode.scaleX = pos.x / 240\r\n        //     }\r\n        // }, this)\r\n        // cutCtrlNode.on(cc.Node.EventType.TOUCH_START, function () {\r\n\r\n        // }, this)\r\n        // cutCtrlNode.on(cc.Node.EventType.TOUCH_END, function (touch) {\r\n\r\n        // }, this)\r\n\r\n        // this.timerAudioId = cc.musicMgr.playEffect(\"daojishi.mp3\", true)\r\n        // cc.audioEngine.stop(this.timerAudioId)\r\n\r\n        //进入后台 \r\n        // cc.eventManager.addCustomListener(cc.game.EVENT_HIDE, function (event) {\r\n        //     cc.log(\"进入后台\")\r\n        // });\r\n        // // //恢复显示 \r\n        // cc.eventManager.addCustomListener(cc.game.EVENT_SHOW, function (event) {\r\n        //     cc.log(\"进入前台\")\r\n        // });\r\n\r\n        // this.find(\"aniXiandui\").getComponent(cc.Animation).on('stop', function () {\r\n        //     this.find(\"aniXiandui\").active = false\r\n        // }, this)\r\n        // this.find(\"aniWin\").getComponent(cc.Animation).on('stop', function () {\r\n        //     this.find(\"aniWin\").active = false\r\n        // }, this)\r\n\r\n        // cc.director.getScheduler().schedule(function () {\r\n        //     cc.log(\"vvvv\")\r\n        // }, this, 1, 0, 0, false)\r\n        // cc.log(\"kkk\")\r\n        // scheduleTimeOut(function () {\r\n        //     cc.log(\"iii\")\r\n        // }, this, 0.5)\r\n\r\n        // cc.log(\"1111\")\r\n        // scheduleTimeOut(function () {\r\n        //     cc.log(\"iii\")\r\n        // }, this, 2)\r\n        // cc.log(\"2222\")\r\n        // outputObj(jsb.fileUtils)\r\n    },\r\n\r\n    login: function () {\r\n        this.init()\r\n        gUserData.uid = Number(this.find(\"editAccount\").string)\r\n        gUserData.password = this.find(\"password\").string\r\n        // cc.director.loadScene('LobbyScene')\r\n\r\n        this.saveServerSelect()\r\n\r\n        // this.find(\"node_quanxian_zhuang\").getComponent(\"PowerObj\").flip()\r\n\r\n        // this.find(\"aniXiandui\").active = true\r\n        // this.find(\"aniXiandui\").getComponent(cc.Animation).play()\r\n        // this.find(\"aniWin\").active = true\r\n        // this.find(\"aniWin\").getComponent(cc.Animation).play()\r\n\r\n        // var card = cc.instantiate(cc.res[\"prefabs/card/Card\"])\r\n        // card.parent = this.node\r\n        // card.js.reset()\r\n        // card.js.showBack()\r\n        // card.js.setData({cards: 1, type: 1}, 1)\r\n        // card.js.flip()\r\n\r\n        // cc.director.getScheduler().unscheduleAllForTarget(this)\r\n        // cc.log(\"3333\")\r\n    },\r\n\r\n    saveServerSelect: function () {\r\n        var children = this.find(\"New ToggleContainer\")._children\r\n        for (var i = 0; i < children.length; i++) {\r\n            var toggle = children[i].getComponent(cc.Toggle)\r\n            if (toggle.isChecked) {\r\n                cc.sys.localStorage.setItem(\"connectServer\", children[i]._name)\r\n                break\r\n            }\r\n        }\r\n        var connectServer = cc.sys.localStorage.getItem('connectServer')\r\n        if (connectServer == \"toggle1\") {\r\n            gHost = gHostDev\r\n        }\r\n        else if (connectServer == \"toggle2\") {\r\n            gHost = gHostTest\r\n        }\r\n        else if (connectServer == \"toggle3\") {\r\n            gHost = gHostPro\r\n        }\r\n    },\r\n\r\n    loadServerSelect: function () {\r\n        cc.log(\"loadServerSelect++++\")\r\n        var connectServer = cc.sys.localStorage.getItem('connectServer')\r\n        var children = this.find(\"New ToggleContainer\")._children\r\n        for (var i = 0; i < children.length; i++) {\r\n            var toggle = children[i].getComponent(cc.Toggle)\r\n            toggle.isChecked = false\r\n        }\r\n        if (connectServer) {\r\n            this.find(connectServer).getComponent(cc.Toggle).isChecked = true\r\n        }\r\n        else {\r\n            gHost = gHostTest //默认测试服\r\n            this.find(\"toggle2\").getComponent(cc.Toggle).isChecked = true\r\n        }\r\n    },\r\n\r\n    onDestroy: function () {\r\n        // cc.log(\"onDestroy\")\r\n    },\r\n\r\n    start: function () {\r\n        this._super()\r\n    },\r\n\r\n    onBtnUpdate: function () {\r\n        this.find(\"nodeHotUpdate\").node.active = !this.find(\"nodeHotUpdate\").node.active\r\n    },\r\n\r\n    init: function () {\r\n        var self = this\r\n        cc.netMgr = new NetMgr()\r\n        cc.netMgr.initData()\r\n        cc.eventMgr = new EventMgr()\r\n        cc.resMgr = new ResMgr()\r\n        cc.resMgr.init()\r\n        cc.res = cc.resMgr.resList\r\n        cc.musicMgr = new MusicMgr()\r\n    },\r\n\r\n});\r\n"]}