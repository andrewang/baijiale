{"version":3,"sources":["../../../../../../assets/scripts/common/base/assets/scripts/common/base/BaseScene.js"],"names":["BaseObj","require","BaseScene","cc","Class","extends","properties","moduleName","override","default","visible","childViews","type","Prefab","_childViewInstance","loadingViewPrefab","onLoad","_super","mgr","node","addComponent","view","sceneNode","director","getScene","getChildByName","gNode","Node","game","addPersistRootNode","parent","Common","common","init","adjustGnode","loader","loadRes","err","prefab","instantiate","setLocalZOrder","bind","start","winSize","getWinSize","framesSize","getFrameSize","width","setContentSize","height","position","x","y","openView","url","param","res","_components","show","js","isViewOnOpen","isShow","openLogView","on","name","callback","onDestroy","showLoadingView","loadingView","hideLoadingView","hide"],"mappings":"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","file":"BaseScene.js","sourceRoot":"../../../../../../assets/scripts/common/base","sourcesContent":["var BaseObj = require(\"BaseObj\")\r\nvar BaseScene = cc.Class({\r\n    extends: BaseObj,\r\n\r\n    properties: {\r\n        // //挂载所有该场景的plsit资源\r\n        // SA_SHEET:{\r\n        //     type:[cc.SpriteAtlas],\r\n        //     default:[],\r\n        // },\r\n\r\n        // ARR_Prefab___:{\r\n        //     type:[cc.Prefab],\r\n        //     default:[],\r\n        // },\r\n\r\n        //模块名字\r\n        moduleName: {\r\n            override: true,\r\n            default: \"\",\r\n            // type: 'String',\r\n            visible: false,\r\n        },\r\n\r\n        //子界面数组\r\n        childViews: {\r\n            type: cc.Prefab,\r\n            default: [],\r\n        },\r\n\r\n        //子界面实例\r\n        _childViewInstance: {\r\n            default: []\r\n        },\r\n\r\n        loadingViewPrefab: cc.Prefab,\r\n    },\r\n\r\n    onLoad: function () {\r\n        this._super()\r\n\r\n        this.mgr = this.node.addComponent(this.moduleName + \"Mgr\")\r\n        this.mgr.view = this\r\n        // cc.common = this.node.getComponent('Common')\r\n        cc.sceneNode = cc.director.getScene().getChildByName('Canvas')\r\n        //msgbar这种东西切换场景需要继续显示，所以需要常驻节点\r\n        if (!cc.gNode) {\r\n            cc.gNode = new cc.Node('gNode')\r\n            cc.game.addPersistRootNode(cc.gNode)\r\n            cc.gNode.parent = cc.director.getScene()\r\n\r\n            var Common = require(\"Common\")\r\n            cc.common = new Common()\r\n            cc.common.init()\r\n        }\r\n        // //分辨率适配方案\r\n        // var cvs = cc.sceneNode.getComponent(cc.Canvas);\r\n        // var rate = cc.view.getFrameSize().width / cc.view.getFrameSize().height\r\n        // if (rate >= 1280 / 720) {\r\n        //     cvs.fitHeight = true\r\n        //     cvs.fitWidth = false\r\n        // }\r\n        // else {\r\n        //     cvs.fitHeight = false\r\n        //     cvs.fitWidth = true\r\n        // }\r\n        //这里动态改变每个场景的适配方案，常驻节点也要动态适配\r\n        this.adjustGnode()\r\n        // scheduleTimeOut(function () {\r\n        //     this.adjustGnode()\r\n        // }.bind(this), this, 0)\r\n\r\n        this.childViews = []\r\n        this._childViewInstance = []\r\n\r\n        cc.loader.loadRes(\"prefabs/versionView/VersionView\", function (err, prefab) {\r\n            var view = cc.instantiate(prefab)\r\n            view.parent = this.node\r\n            view.setLocalZOrder(100)\r\n        }.bind(this))\r\n    },\r\n\r\n    start: function () {\r\n        \r\n    },\r\n\r\n    //适配常驻节点\r\n    adjustGnode: function () {\r\n        var winSize = cc.director.getWinSize()\r\n        var framesSize = cc.view.getFrameSize()\r\n        // cc.log(\"111111\", winSize.width, winSize.height)\r\n        // cc.log(\"22222\", framesSize.width, framesSize.height)\r\n        // cc.log(\"33333\", cc.view.getScaleX(), cc.view.getScaleY())\r\n        if (framesSize.width < winSize.width) {\r\n            cc.gNode.setContentSize({ width: winSize.width, height: winSize.height })\r\n        }\r\n        else {\r\n            cc.gNode.setContentSize({ width: framesSize.width, height: framesSize.height })\r\n        }\r\n        cc.gNode.position = { x: cc.sceneNode.position.x, y: cc.sceneNode.position.y }\r\n    },\r\n\r\n    openView: function (url,parent, param) {\r\n        var view = null\r\n        if (this._childViewInstance[url]) {\r\n            view = this._childViewInstance[url]\r\n        } else {\r\n            var prefab = cc.res[url]\r\n            view = cc.instantiate(prefab)\r\n            this._childViewInstance[url] = view\r\n            view.parent = parent ? parent : this.node\r\n        }\r\n        view._components[0].show(param)\r\n        view.js = view._components[0]\r\n        return view.js\r\n    },\r\n\r\n    //某个界面是否打开\r\n    isViewOnOpen: function (url) {\r\n        var view = this._childViewInstance[url]\r\n        if (view) {\r\n            return view._components[0].isShow()\r\n        }\r\n        return false\r\n    },\r\n\r\n    openLogView: function () {\r\n        this.openView(\"prefabs/logView/LogView\")\r\n        // cc.netMgr.onAppBack()\r\n        // cc.netMgr.onAppFront()\r\n    },\r\n\r\n    on: function (name, callback) {\r\n        // this.listener.push({name : name, callback : callback})\r\n        // this.node.on(name, callback, this)\r\n    },\r\n\r\n    onDestroy: function () {\r\n        // cc.log(\"BaseScene:onDestroy\")\r\n        // for (var key in this._childViewInstance) {\r\n        //     cc.log(\"???\", this._childViewInstance[key].name)\r\n        // }\r\n    },\r\n\r\n    showLoadingView: function () {\r\n        var view = null\r\n        if (this._childViewInstance[\"loadingView\"]) {\r\n            view = this._childViewInstance[\"loadingView\"]\r\n        } else {\r\n            view = cc.instantiate(this.loadingViewPrefab)\r\n            this._childViewInstance[\"loadingView\"] = view\r\n            view.parent = this.node\r\n        }\r\n        view.setLocalZOrder(100)\r\n        view._components[0].show()\r\n        view.js = view._components[0]\r\n        this.loadingView = view\r\n        return view.js\r\n    },\r\n\r\n    hideLoadingView: function () {\r\n        if (this.loadingView) {\r\n            this.loadingView.js.hide()\r\n        }\r\n    },\r\n\r\n});\r\n"]}