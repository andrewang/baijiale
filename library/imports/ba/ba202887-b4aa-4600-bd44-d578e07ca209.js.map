{"version":3,"sources":["../../../../../../assets/scripts/net/http/assets/scripts/net/http/CustomHttpClient.js"],"names":["CryptoJS","require","CustomHttpClient","cc","Class","extends","Component","properties","send","customHttpRequest","handler","startTimeOutTimer","xhr","sys","isNative","setRequestHeader","self","onreadystatechange","_requestType","open","_url","timestamp","md5RawData","_data","sign","MD5","newUrl","indexOf","console","log","_fileName","data","jsb","fileUtils","getDataFromFile","responseType","readyState","isEnd","clearTimeOutTimer","status","requestType","response","writeDataToFile","Uint8Array","undefined","responseText","instance","module","exports"],"mappings":"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","file":"CustomHttpClient.js","sourceRoot":"../../../../../../assets/scripts/net/http","sourcesContent":["var CryptoJS = require('CryptoJS');\nvar CustomHttpClient = cc.Class({\n    extends: cc.Component,\n\n    properties: {\n\n    },\n\n    send : function(customHttpRequest,handler){\n        customHttpRequest.startTimeOutTimer(function(){\n            handler(null,'网络超时');\n        });\n        var xhr = customHttpRequest.xhr;\n        if (cc.sys.isNative){\n            xhr.setRequestHeader(\"Accept-Encoding\",\"gzip,deflate\",\"text/html;charset=UTF-8\");\n        }\n        var self = this;\n        xhr.onreadystatechange = function() {\n            self.onreadystatechange(customHttpRequest,handler);\n        };\n        switch(customHttpRequest._requestType){\n            case 'GET':\n            {\n                xhr.open(\"GET\",customHttpRequest._url, true);\n                xhr.send();\n            }\n            break;\n            case 'POST':\n            {\n                var timestamp = '1';\n                var md5RawData = 'm5IaxZxmBwrlc2O' + timestamp + customHttpRequest._data;\n                var sign = ''+CryptoJS.MD5(md5RawData);\n                var newUrl = customHttpRequest._url.indexOf('?') > 0 ? (customHttpRequest._url + '&') :  (customHttpRequest._url + '?');\n                newUrl += 'timestamp=' + timestamp + '&sign=' + sign\n                xhr.open(\"POST\",newUrl, true);\n                xhr.setRequestHeader(\"Content-Type\", \"application/x-www-form-urlencoded\");\n                xhr.send(customHttpRequest._data);\n            }\n            break;\n            case 'UPLOAD':\n            {\n                xhr.open(\"POST\",customHttpRequest._url, true);\n                if (cc.sys.isNative){\n                    // xhr.setRequestHeader('Content-Type','application/octet-stream');\n                    xhr.setRequestHeader('Content-Type','application/json');\n                    console.log('上传的文件名为:'+customHttpRequest._fileName)\n                    var data = jsb.fileUtils.getDataFromFile(customHttpRequest._fileName);\n                    xhr.send(data);\n                }else{\n                    xhr.send('hahahahahhahahahahhahhahahah');                    \n                }\n                console.log('上传地址:'+customHttpRequest._url);        \n            }\n            break;\n            case 'DOWNLOAD' : {\n                xhr.responseType = 'arraybuffer';\n                xhr.open(\"GET\",customHttpRequest._url, true);\n                xhr.send();\n                console.log('下载地址:'+customHttpRequest._url); \n            }   \n            break;         \n        } \n                \n    },\n\n    onreadystatechange : function(customHttpRequest,handler){\n        var xhr = customHttpRequest.xhr;\n        if( xhr.readyState === 4 ){\n            if(customHttpRequest.isEnd == true){\n                return;\n            }\n            customHttpRequest.clearTimeOutTimer();\n            if(xhr.status >= 200 && xhr.status < 300){\n                var requestType = customHttpRequest._requestType;\n                if(requestType == 'DOWNLOAD'){\n                    if(cc.sys.isNative && xhr.response){\n                        jsb.fileUtils.writeDataToFile(new Uint8Array(xhr.response),customHttpRequest._fileName);\n                        if(handler !== null && handler != undefined){\n                             handler(customHttpRequest); \n                        }                         \n                    }else{\n                        console.log(xhr.responseText);\n                    }\n                }else{\n                        if(handler !== null && handler != undefined){\n                            handler(customHttpRequest);\n                        }   \n                }\n\n            }else{\n                if(handler !== null && handler != undefined){\n                    handler(null,xhr.status);\n                }\n                \n            }\n\n        }        \n    },\n    \n});\n\nCustomHttpClient.instance = new CustomHttpClient();\nmodule.exports = CustomHttpClient;\n"]}