{"version":3,"sources":["../../../../../../assets/scripts/common/record/assets/scripts/common/record/RecordMgr.js"],"names":["CatalogHelper","require","CustomHttpClient","CustomHttpRequest","cc","Class","extends","Component","properties","_isRecording","statics","create","instance","getInstance","startRecord","_startTime","Date","getTime","sys","isNative","_fileName","getNewFileName","os","OS_ANDROID","className","mathodName","mathodSignature","param","isCanStart","jsb","reflection","callStaticMethod","console","log","OS_IOS","arg1","tryToStopRecord","moveType","_moveType","_endTime","deltaTime","getCurRecordTime","scheduleTimeOut","stopRecord","second","uploadVoice","requestURL","netMgr","_commonNetMgr","getGameServerIp","gUserData","uid","roomInfo","room_num","customHttpRequest","setRequestType","setTimeout","setUrl","setFile","send","customHttpRequest1","ret","JSON","parse","xhr","responseText","url","testUrl","request","type","words","bind","downloadVoice","filePath","getFilePath","decodeFile","musicMgr","playVoice","getPlayableFilePath","status","ErrorStatus","testPlay","fileUtils","isFileExist","convertToAmr","fileName","arg2","replace","time","path","getRecordCatalog","floorSecond","Math","floor","ceilSecond","ceil","downLoadPath","playableFile","index","lastIndexOf","slice","length","getDownloadCatalog","downloadFilePath"],"mappings":"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","file":"RecordMgr.js","sourceRoot":"../../../../../../assets/scripts/common/record","sourcesContent":["var CatalogHelper = require('CatalogHelper');\nvar CustomHttpClient = require('CustomHttpClient');\nvar CustomHttpRequest = require('CustomHttpRequest');\n\ncc.Class({\n    extends: cc.Component,\n\n    properties: {\n        _isRecording : false,\n    },\n\n    statics: {\n        create: function () {\n            this.instance = new this\n            return this.instance\n        },\n        getInstance: function () {\n            return this.instance\n        },\n    },\n\n    // onTouchStart: function (touch) {\n    //     this._isCanStart = this.isCanStart(touch);\n    //     if (this._isCanStart == false && this._isRecording == true) {\n    //         console.log(this._isCanStart);\n    //         return;\n    //     } else {\n    //         //开始录制\n    //         this._isCanStart = this.startRecord();\n    //         if (this._isCanStart && this.recordStartEvent) {\n    //             this.recordStartEvent.emit();\n    //         }\n    //     }\n    // },\n\n    // onTouchMove: function (touch) {\n    //     if (this._isCanStart == false) {\n    //         return;\n    //     } else {\n    //         if (this.recordMoveEvent) {\n    //             var pos = this.node.parent.convertTouchToNodeSpaceAR(touch);\n    //             var tempMoveType = (pos.y > this.node.y) ? this.MOVE_UP : this.MOVE_DOWN;\n    //             if (tempMoveType != this._moveType) {\n    //                 this._moveType = tempMoveType;\n    //                 this.recordMoveEvent.emit([this._moveType]);\n    //             }\n    //         }\n    //     }\n    // },\n\n    // onTouchEnd: function (touch) {\n    //     console.log(\"------------onTouchEnd\");\n    //     if (this._isCanStart == false) {\n    //         return;\n    //     } else {\n    //         this._isCanStart = false\n    //         console.log(\"-------------onTouchEnd this._isCanStart == true\");\n    //         var second = this.tryToStopRecord();\n\n    //     }\n    // },\n\n    // onTouchCancel: function (touch) {\n    //     this.onTouchEnd(touch);\n    // },\n\n    startRecord: function () {\n        if (this._isRecording == true) {\n            return\n        }\n        this._startTime = new Date().getTime();\n        if (cc.sys.isNative) {\n            this._fileName = this.getNewFileName();\n            if (cc.sys.os == cc.sys.OS_ANDROID) {\n                var className = 'org/cocos2dx/javascript/RecordAndPlayHelper';\n                var mathodName = 'startRecord';\n                var mathodSignature = '(Ljava/lang/String;)Z';\n                var param = this._fileName;\n                var isCanStart = jsb.reflection.callStaticMethod(className, mathodName, mathodSignature, param);\n                console.log('andoird 录音返回' + isCanStart);\n                this._isRecording = true;\n                return isCanStart;\n            } else if (cc.sys.os == cc.sys.OS_IOS) {\n                var className = 'RecordAndPlayHelper';\n                var mathodName = 'startRecord:';\n                var arg1 = this._fileName;\n                jsb.reflection.callStaticMethod(className, mathodName, arg1);\n                this._isRecording = true;\n                return true;\n            }\n        }\n        return true;\n    },\n\n    //moveType 0为取消发送 1为发送语音\n    tryToStopRecord: function (moveType) {\n        if (cc.sys.isNative) {\n            this._moveType = moveType\n            this._endTime = new Date().getTime();\n            var deltaTime = this.getCurRecordTime();\n            if (deltaTime < 1) {\n                // this.node.runAction(cc.sequence(cc.delayTime(0.3),cc.callFunc(this.stopRecord,this)));\n                scheduleTimeOut(this.stopRecord, this, 0.3)\n                // if(this.recordEndEvent){\n                //     this.recordEndEvent.emit([this._fileName,0,this._moveType]);\n                // } \n            } else {\n                var second = this.stopRecord();\n                // if(this.recordEndEvent){\n                //     this.recordEndEvent.emit([this._fileName,second,this._moveType]);\n                // } \n            }\n        }\n    },\n\n    uploadVoice: function (deltaTime) {\n        var requestURL = cc.netMgr._commonNetMgr.getGameServerIp() + \"/voice?uid=\" + gUserData.uid + \"&rid=\" + gUserData.roomInfo.room_num + \"&second=\" + deltaTime\n        var customHttpRequest = new CustomHttpRequest();\n        customHttpRequest.setRequestType('UPLOAD');\n        customHttpRequest.setTimeout(5000);\n        customHttpRequest.setUrl(requestURL);\n        customHttpRequest.setFile(this._fileName)\n        // customHttpRequest.setFile(cc.url.raw(\"resources/music/\" + \"please_cut_card.mp3\"))\n        CustomHttpClient.instance.send(customHttpRequest, function (customHttpRequest1) {\n            if (customHttpRequest1) {\n                var ret = JSON.parse(customHttpRequest1.xhr.responseText);\n                // var ret = JSON.parse(customHttpRequest1);\n                cc.log(\"上传录音\", ret.url);\n                this.testUrl = ret.url\n                //发送录音\n                cc.netMgr.request(\"room_chat\", { type: 4, words: ret.url }, function (ret) {\n                    \n                }.bind(this))\n            } else {\n                cc.log(null, '网络错误');\n            }\n        }.bind(this))\n    },\n\n    downloadVoice: function (url) {\n        url = url || this.testUrl\n        var filePath = this.getFilePath(url);\n        console.log('下载后的路径为:' + filePath);\n        var customHttpRequest = new CustomHttpRequest();\n        customHttpRequest.setRequestType('DOWNLOAD');\n        customHttpRequest.setTimeout(10000);\n        customHttpRequest.setUrl(url);\n        customHttpRequest.setFile(filePath);\n        CustomHttpClient.instance.send(customHttpRequest, function (customHttpRequest1) {\n            if (customHttpRequest1) {\n                // this.status = DecodeStatus;\n                this.decodeFile(filePath)\n                cc.musicMgr.playVoice(this.getPlayableFilePath(filePath))\n                // this.playVoice(this.getPlayableFilePath(filePath))\n            } else {\n                console.log('网络出错');\n                this.status = ErrorStatus;\n            }\n        }.bind(this));\n    },\n\n    testPlay: function () {\n        cc.log(\"测试播放\", this.getPlayableFilePath(this._fileName))\n        cc.log(\"是否存在\", jsb.fileUtils.isFileExist(this.getPlayableFilePath(this._fileName)))\n        cc.musicMgr.playVoice(this.getPlayableFilePath(this._fileName))\n    },\n\n    // playVoice: function (filepath) {\n    //     console.log('播放路径 = ' + filepath);\n    //     if (filepath == '') {\n    //         return;\n    //     }\n    //     if (cc.sys.isNative) {\n    //         if (cc.sys.os == cc.sys.OS_ANDROID) {\n    //             var className = 'org/cocos2dx/javascript/RecordAndPlayHelper';\n    //             var mathodName = 'playVoice';\n    //             var mathodSignature = '(Ljava/lang/String;)V';\n    //             var param = filepath;\n    //             jsb.reflection.callStaticMethod(className, mathodName, mathodSignature, param);\n    //         } else if (cc.sys.os == cc.sys.OS_IOS) {\n    //             var className = 'RecordAndPlayHelper';\n    //             var mathodName = 'playVoice:';\n    //             var arg1 = filepath;\n    //             jsb.reflection.callStaticMethod(className, mathodName, arg1);\n    //         }\n    //     }\n    // },\n\n    stopRecord: function () {\n        console.log('停止录音');\n        if (cc.sys.isNative) {\n            var deltaTime = this.getCurRecordTime();\n            if (cc.sys.os == cc.sys.OS_ANDROID) {\n                var className = 'org/cocos2dx/javascript/RecordAndPlayHelper';\n                var mathodName = 'stopRecord';\n                var mathodSignature = '()V';\n                jsb.reflection.callStaticMethod(className, mathodName, mathodSignature);\n            } else if (cc.sys.os == cc.sys.OS_IOS) {\n                var className = 'RecordAndPlayHelper';\n                var mathodName = 'stopRecord';\n                jsb.reflection.callStaticMethod(className, mathodName);\n                this._fileName = deltaTime < 1 ? \"\" : this.convertToAmr(this._fileName);\n            }\n            this._isRecording = false;\n            //上传录音\n            cc.log(\"上传录音\", deltaTime)\n            if (this._moveType != 0 && deltaTime >= 1) {\n                this.uploadVoice(deltaTime)\n            }\n\n            return deltaTime;\n        }\n        return 0;\n    },\n\n    convertToAmr: function (fileName) {\n        if (cc.sys.os == cc.sys.OS_IOS) {\n            var className = 'RecordAndPlayHelper';\n            var mathodName = 'convertWAV:toAMR:';\n            var arg1 = fileName;\n            var arg2 = fileName.replace('.wav', '.amr');\n            jsb.reflection.callStaticMethod(className, mathodName, arg1, arg2);\n            return arg2;\n        }\n    },\n\n    getNewFileName: function () {\n        var time = new Date().getTime();\n        var path = '';\n        if (cc.sys.os == cc.sys.OS_ANDROID) {\n            path = CatalogHelper.getRecordCatalog() + time + '.amr';\n        } else if (cc.sys.os == cc.sys.OS_IOS) {\n            path = CatalogHelper.getRecordCatalog() + time + '.wav';\n        }\n        console.log(path);\n        return path;\n    },\n\n    getCurRecordTime: function () {\n        var time = this._endTime - this._startTime;\n        console.log(time / 1000);\n        var floorSecond = Math.floor((time / 1000));\n        var ceilSecond = Math.ceil((time / 1000));\n\n        return (floorSecond >= 1 ? ceilSecond : floorSecond);\n    },\n\n    decodeFile: function (filePath) {\n        if (cc.sys.isNative) {\n            if (cc.sys.os == cc.sys.OS_ANDROID) {\n                // this.status = CompleteStatus;\n            } else if (cc.sys.os == cc.sys.OS_IOS) {\n                var downLoadPath = filePath;\n                var playableFile = this.getPlayableFilePath(filePath);\n                var className = 'RecordAndPlayHelper';\n                var mathodName = 'convertAMR:toWAV:';\n                var arg1 = downLoadPath;\n                var arg2 = playableFile;\n                jsb.reflection.callStaticMethod(className, mathodName, arg1, arg2);\n                // this.status = CompleteStatus;\n            }\n            console.log('decodeFile后status=' + this.status);\n        } else {\n            // this.status = CompleteStatus;\n            console.log('非原生平台不能播放录音');\n        }\n    },\n\n    getFilePath: function (url) {\n        if (cc.sys.isNative) {\n            var index = url.lastIndexOf('=');\n            var filePath = url.slice(index + 1, url.length);\n            filePath += '.amr';\n            filePath = CatalogHelper.getDownloadCatalog() + filePath;\n            return filePath;\n\n            //test\n            // return this._fileName;\n        }\n    },\n\n    getPlayableFilePath: function (filePath) {\n        // var downloadFilePath = this.getFilePath()\n        var downloadFilePath = filePath\n        // if (cc.sys.os == cc.sys.OS_IOS) {\n        if (cc.sys.os != cc.sys.OS_ANDROID) {\n            downloadFilePath = downloadFilePath.replace('.amr', '.wav');\n        }\n        return downloadFilePath;\n    },\n\n});\n"]}