{"version":3,"sources":["../../../../../../../../assets/scripts/app/lobby/view/CreateRoom/assets/scripts/app/lobby/view/CreateRoom/CreateRoomMgr.js"],"names":["BaseMgr","require","CreateRoomConfig","GameToAppHelper","self","Code","http","cc","Class","extends","properties","onLoad","saveRuleData","ruleArr","view","node","getComponentsInChildren","Toggle","ruleData","i","length","active","isChecked","push","name","sys","localStorage","setItem","JSON","stringify","loadRuleData","parse","getItem","indexOf","loadPhpData","sendRequest","type","ret","status","log","netMgr","exec","toggleJuShu","find","toggle1","toggle2","toggle3","data","element","toggle","game_num","room_card","string","tag","substring","getComponent","bind","requestCreateRoom","cfg","index","roomParams","low_bet","hig_bet","yazhu","room_setup_info","inning_num","jushu","midway_join","jiaru","squeeze_cards","jipai","group_id","gUserData","dingdingData","gameData","groupId","clubId","uid","USER_ALREAY_IN_OTHER_GAME","code","common","showMsgBox","msg","okCb","err","sceneNode","js","openView","chongZhi","roomInfo","rid","requestJoin","showLoadingView","setTimeout","request","gid","room_info","shareCreateClubGame","director","loadScene"],"mappings":"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","file":"CreateRoomMgr.js","sourceRoot":"../../../../../../../../assets/scripts/app/lobby/view/CreateRoom","sourcesContent":["var BaseMgr = require(\"BaseMgr\")\nvar CreateRoomConfig = require(\"CreateRoomConfig\")\nvar GameToAppHelper = require(\"GameToAppHelper\")\nvar self = null\nvar Code = require(\"Code\")\nvar http = require(\"Http\");\n\ncc.Class({\n    extends: BaseMgr,\n\n    properties: {\n\n    },\n\n    // ctor: function () {\n    //     this.view = arguments[0]\n    // },\n\n    onLoad: function () {\n\n    },\n\n    saveRuleData: function () {\n        var ruleArr = this.view.node.getComponentsInChildren(cc.Toggle)\n        var ruleData = []\n        for (var i = 0; i < this.view.node.getComponentsInChildren(cc.Toggle).length; i++) {\n            if (ruleArr[i].node.active && ruleArr[i].isChecked) {\n                ruleData.push(ruleArr[i].name)\n            }\n        }\n        cc.sys.localStorage.setItem(\"ruleData\", JSON.stringify(ruleData))\n        this.ruleData = ruleData\n    },\n\n    loadRuleData: function () {\n        var ruleData = JSON.parse(cc.sys.localStorage.getItem('ruleData'))\n        this.ruleData = ruleData\n        if (!ruleData) {\n            return\n        }\n        // cc.log(ruleData)\n        var ruleArr = this.view.node.getComponentsInChildren(cc.Toggle)\n        for (var i = 0; i < this.view.node.getComponentsInChildren(cc.Toggle).length; i++) {\n            if (-1 != ruleData.indexOf(ruleArr[i].name)) {\n                ruleArr[i].isChecked = true\n            }\n            else {\n                ruleArr[i].isChecked = false\n            }\n        }\n    },\n\n    //读取后台配置的数据\n    loadPhpData: function () {\n        http.sendRequest(\"/game/room_settings\", {type : 1}, function (ret, status) {\n            cc.log(ret)\n            cc.netMgr.exec(ret, function () {\n                var toggleJuShu = this.view.find(\"toggleJuShu\")\n                toggleJuShu.toggle1.active = false\n                toggleJuShu.toggle2.active = false\n                toggleJuShu.toggle3.active = false\n                for (var i = 0; i < ret.data.length; i++) {\n                    var element = ret.data[i]\n                    cc.log(toggleJuShu[\"toggle\" + (i + 1)])\n                    var toggle = toggleJuShu[\"toggle\" + (i + 1)]\n                    toggle.active = true\n                    // if (element.tag == \"\") {\n                    //     element.tag = \"体验局\"\n                    // }\n                    toggle.game_num = element.game_num\n                    toggle.room_card = element.room_card\n                    if (0 == element.room_card) {\n                        this.view.find(\"richText\" + (i + 1)).string = \"<color=#ffffff>\" + element.game_num + \"局(限时免费)\"\n                        this.view.find(\"btnFreeCreate\").active = true\n                        this.view.find(\"btnCreate\").active = false\n                    }\n                    else {\n                        this.view.find(\"richText\" + (i + 1)).string = \"<color=#ffffff>\" + element.game_num + \"局(\" + element.tag + \"<img src=\\\"btn_roomcard\\\"/><color=#0fffff>x\" \n                        + element.room_card + \")</color>\"\n                        this.view.find(\"btnFreeCreate\").active = false\n                        this.view.find(\"btnCreate\").active = true\n                        // <color=#00ff00>Ri<img src=\"emoji1\" click=\"clickme\"/><u>c\n                        // h</u></c><color=#0fffff><size=77>Te</s><img src=\"emoji2\" />x\n                        // t</color><img src=\"emoji3\" />\n                        // <color=#ffffff>20局(<img src=\"btn_jewel\"/><color=#0fffff>x5)</color>\n                    }\n                }\n                //当toggle隐藏的时候，会自动选中其他没隐藏的toggle，所以导致选中的toggle不正确，这里重新选中一下\n                this.view.find(this.ruleData[0].substring(0, 7)).getComponent(cc.Toggle).isChecked = true\n            }.bind(this))\n        }.bind(this))\n    },\n\n    requestCreateRoom: function () {\n        this.saveRuleData()\n        self = this\n        var ruleData = this.ruleData\n        var cfg = {}\n        for (var index = 0; index < ruleData.length; index++) {\n            if (ruleData[index] == \"toggle1<Toggle>\" || ruleData[index] == \"toggle2<Toggle>\" || ruleData[index] == \"toggle3<Toggle>\") {\n                cfg[\"jushu\"] = ruleData[index]\n            }\n            else if (ruleData[index] == \"toggle7<Toggle>\" || ruleData[index] == \"toggle8<Toggle>\") {\n                cfg[\"yazhu\"] = ruleData[index]\n            }\n            else if (ruleData[index] == \"toggle5<Toggle>\" || ruleData[index] == \"toggle6<Toggle>\") {\n                cfg[\"jipai\"] = ruleData[index]\n            }\n            else if (ruleData[index] == \"toggle4<Toggle>\") {\n                cfg[\"jiaru\"] = ruleData[index]\n            }\n        }\n        // cc.log(JSON.stringify(cfg))\n        var roomParams = CreateRoomConfig.roomParams\n        var http = require(\"Http\")\n        var low_bet\n        var hig_bet\n        if (1 == roomParams.yazhu[cfg.yazhu]) {\n            low_bet = 1\n            hig_bet = 1000\n        }\n        else {\n            low_bet = 10\n            hig_bet = 10000\n        }\n        // cc.log(\"-----\" ,cfg.jushu.substring(0, 7), this.view.find(cfg.jushu.substring(0, 7)))\n        var room_setup_info = {\n            // inning_limit_type: roomParams.jushu[cfg.jushu], bet_limit_type: roomParams.yazhu[cfg.yazhu],\n            inning_num: this.view.find(cfg.jushu.substring(0, 7)).game_num,\n            room_card: this.view.find(cfg.jushu.substring(0, 7)).room_card,\n            low_bet : low_bet,\n            hig_bet : hig_bet,\n            midway_join: roomParams.jiaru[cfg.jiaru] || 2, squeeze_cards: roomParams.jipai[cfg.jipai],\n            group_id : 0,\n            type : 0,\n        }\n        cc.log(room_setup_info)\n        var group_id = null\n        if (gUserData.dingdingData.gameData) {\n            cc.log(\"群ID\", gUserData.dingdingData.gameData.groupId)\n            group_id = gUserData.dingdingData.gameData.groupId\n            //百家乐还没俱乐部功能，策划说要在丁丁俱乐部进入当群进入\n            if (gUserData.dingdingData.gameData.clubId != 0) {\n                group_id = gUserData.dingdingData.gameData.clubId\n            }\n            cc.log(\"俱乐部id\", gUserData.dingdingData.gameData.clubId)\n            room_setup_info.group_id = group_id || 0\n        }\n        var data = { uid: gUserData.uid, room_setup_info: room_setup_info , }\n        http.sendRequest(\"/game/create_room\", data, function (ret) {\n            cc.log(ret)\n            //在丁丁的其他游戏中\n            if (Code.USER_ALREAY_IN_OTHER_GAME == ret.code) {\n                cc.common.showMsgBox({type: 2, msg: \"您正在游戏中\", okCb: function () {\n                        \n                    }})\n                return\n            }\n            if (ret.err == \"DIAMOND_NOT_FULL\"){    //钻石不足创建失败\n                cc.common.showMsgBox({\n                    type: 2, msg: \"钻石不足，请充值！\", okCb: function () {\n                        cc.sceneNode.js.openView(\"prefabs/mall/mallView\")\n                    }\n                    , chongZhi: true})\n                return\n            }\n            cc.netMgr.exec(ret, function () {\n                // gUserData.roomInfo.rid = ret.\n                gUserData.roomInfo = ret\n\n                cc.sys.localStorage.setItem(\"roomId\", JSON.stringify(ret.rid))\n                self.requestJoin(ret.rid)\n            })\n        });\n    },\n\n    //创建房间后手动加入房间\n    requestJoin: function (rid) {\n        cc.sceneNode.js.showLoadingView()\n        setTimeout(function () {\n            cc.netMgr.request(\"room_join\", { rid: rid , gid : 0}, function (ret) {\n                cc.netMgr.exec(ret, function () {\n                    // gUserData.roomInfo.rid = rid\n                    cc.log(ret)\n                    gUserData.roomInfo = ret.room_info\n                    GameToAppHelper.shareCreateClubGame()\n                    cc.director.loadScene(\"GameScene\")\n                }.bind(this))\n            }.bind(this))\n        }.bind(this), 10)\n    },\n\n});\n"]}