{"version":3,"sources":["../../../../../../../../assets/scripts/app/game/view/TotalResult/assets/scripts/app/game/view/TotalResult/TotalResultView.js"],"names":["BaseView","require","cc","Class","extends","properties","moduleName","override","default","visible","onLoad","handleExamine","setData","data","i","find","node","active","user_base_info","clone","gUserData","roomInfo","owner_base_info","point","owner_win_total","user_win_total_list","length","info","seatData","gameMgr","getSeatDataByUID","uid","itemJs","win_jetton","showJuShu","room_setup_info","inning_num","showJoin","midway_join","showYaZhu","setTotalBattleRecordData","onUpAGame_data","seat_info_list","seatInfo","owner_profix","user_profix_list","max_inning_num","backToLobbyScene","isForbidGame","common","showMsgBox","type","msg","okCb","GameToAppHelper","ExitGame","hide","onDetailBtn","prent","sceneNode","js","view","openView","reqGameRecord","rid","reqGameRoomData","string","low_bet","hig_bet","totalJushu","onShareBtn","CC_JSB","winSize","director","getWinSize","renderTexture","RenderTexture","create","width","height","Texture2D","PIXEL_FORMAT_RGBA8888","gl","DEPTH24_STENCIL8_OES","begin","_sgNode","visit","end","saveToFile","ImageFormat","PNG","log","jsb","fileUtils","getWritablePath","LogMgr","append","IS_EXAMINE"],"mappings":"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","file":"TotalResultView.js","sourceRoot":"../../../../../../../../assets/scripts/app/game/view/TotalResult","sourcesContent":["var BaseView = require(\"BaseView\")\n\ncc.Class({\n    extends: BaseView,\n\n    properties: {\n        moduleName: {\n            override: true,\n            default: \"TotalResult\",\n            // type: 'String',\n            visible: false,\n        },\n\n    },\n\n    onLoad: function () {\n        // this._super()\n        this.handleExamine()\n    },\n\n    //data :{user_win_total_list, owner_win_total}\n    setData: function (data) {\n        this.data = data\n\n        for (var i = 1; i <= 9; i++) {\n            this.find(\"player\" + i).node.active = false\n        }\n\n        this.find(\"player0\").setData({ user_base_info: clone(gUserData.roomInfo.owner_base_info), point: data.owner_win_total }, true)\n        for (var i = 0; i < data.user_win_total_list.length; i++) {\n            var info = data.user_win_total_list[i] //{uid, win_jetton}\n            var seatData = cc.gameMgr.getSeatDataByUID(info.uid) //{seat, user_base_info}\n            var user_base_info = seatData.user_base_info //{uid, name, avatar, gender, diamonds}\n            var itemJs = this.find(\"player\" + (i + 1))\n            itemJs.setData({ user_base_info: clone(user_base_info), point: info.win_jetton }, false)\n            itemJs.node.active = true\n        }\n\n        this.showJuShu(gUserData.roomInfo.room_setup_info.inning_num)\n        this.showJoin(gUserData.roomInfo.room_setup_info.midway_join)\n        // this.showYaZhu(gUserData.roomInfo.room_setup_info.bet_limit_type)\n        this.showYaZhu()\n    },\n\n    //这个是通过战绩数据显示结算界面，玩家在牌局途中离线，房间解散后再上线则需要显示结算界面\n    setTotalBattleRecordData: function (data) {\n        this.onUpAGame_data = data\n        for (var i = 1; i <= 9; i++) {\n            this.find(\"player\" + i).node.active = false\n        }\n\n        var getSeatDataByUID = function (uid) {\n            for (var i = 0; i < data.seat_info_list.length; i++) {\n                var seatInfo = data.seat_info_list[i]\n                if (uid == seatInfo.user_base_info.uid) {\n                    return seatInfo\n                }\n            }\n\n        }\n\n        this.find(\"player0\").setData({ user_base_info: clone(data.owner_base_info), point: data.owner_profix.win_jetton }, true)\n        for (var i = 0; i < data.user_profix_list.length; i++) {\n            var info = data.user_profix_list[i] //{uid, win_jetton}\n            var seatData = getSeatDataByUID(info.uid) //{seat, user_base_info}\n            var user_base_info = seatData.user_base_info //{uid, name, avatar, gender, diamonds}\n            var itemJs = this.find(\"player\" + (i + 1))\n            itemJs.setData({ user_base_info: clone(user_base_info), point: info.win_jetton }, false)\n            itemJs.node.active = true\n        }\n\n        this.showJuShu(data.max_inning_num)\n        this.showJoin(data.midway_join)\n        // this.showYaZhu(data.bet_limit_type)\n        this.showYaZhu()\n    },\n\n    backToLobbyScene: function () {\n        if (cc.gameMgr.isForbidGame) {\n            cc.common.showMsgBox({\n                type: 2, msg: \"游戏停止运营，房间已解散\", okCb: function () {\n                    GameToAppHelper.ExitGame()\n                }\n            })\n            return\n        }\n        if (cc.gameMgr) {\n            cc.gameMgr.backToLobbyScene()\n        }\n        else {\n            this.hide()\n        }\n    },\n\n    onDetailBtn: function () {\n        var prent = cc.sceneNode.js.find(\"singleBattleRecordNode\")\n        var view = cc.sceneNode.js.openView(\"prefabs/battleRecord/SingleBattleRecordView\", prent ? prent.node : null)\n        // view.owner_uid = gUserData.roomInfo.owner_base_info.uid\n        // view.owner_name = gUserData.roomInfo.owner_base_info.name\n        view.owner_base_info = gUserData.roomInfo.owner_base_info ? gUserData.roomInfo.owner_base_info : this.onUpAGame_data.owner_base_info\n        view.seat_info_list = gUserData.roomInfo.seat_info_list ? gUserData.roomInfo.seat_info_list : this.onUpAGame_data.seat_info_list\n        view.reqGameRecord(gUserData.roomInfo.rid ? gUserData.roomInfo.rid : this.onUpAGame_data.rid)\n        view.reqGameRoomData()\n    },\n\n    showYaZhu: function (type) {\n        // if (1 == type) {\n        //     this.find(\"txt3\").string = \"押注：1-1千\"\n        // }\n        // else if (2 == type) {\n        //     this.find(\"txt3\").string = \"押注：10-1万\"\n        // }\n        this.find(\"txt3\").string = \"押注：\" + this.data.low_bet + \"-\" + this.data.hig_bet\n    },\n\n    showJoin: function (type) {\n        if (1 == type) {\n            this.find(\"txt2\").string = \"允许中途加入\"\n        }\n        else if (2 == type) {\n            this.find(\"txt2\").string = \"不允许中途加入\"\n        }\n    },\n\n    showJuShu: function (type) {\n        // var totalJushu = 0\n        // if (1 == type) {\n        //     totalJushu = 20\n        // }\n        // else if (2 == type) {\n        //     totalJushu = 50\n        // }\n        // else if (3 == type) {\n        //     totalJushu = 80\n        // }\n        var totalJushu = type\n        this.find(\"txt1\").string = \"游戏局数：\" + totalJushu + \"局\"\n    },\n\n    onShareBtn: function () {\n        //截图\n        if (CC_JSB) {\n            //如果待截图的场景中含有 mask，请使用下面注释的语句来创建 renderTexture\n            var winSize = cc.director.getWinSize()\n            // var renderTexture = cc.RenderTexture.create(1280, 720, cc.Texture2D.PIXEL_FORMAT_RGBA8888, gl.DEPTH24_STENCIL8_OES);\n            var renderTexture = cc.RenderTexture.create(winSize.width, winSize.height, cc.Texture2D.PIXEL_FORMAT_RGBA8888, gl.DEPTH24_STENCIL8_OES);\n            //实际截屏的代码\n            renderTexture.begin();\n            //this.richText.node 是我们要截图的节点，如果要截整个屏幕，可以把 this.richText 换成 Canvas 切点即可\n            // this.node._sgNode.visit();\n            cc.find(\"Canvas\")._sgNode.visit();\n            renderTexture.end();\n            renderTexture.saveToFile(\"jietu.png\", cc.ImageFormat.PNG, true, function () {\n                cc.log(\"capture screen successfully!\");\n                //打印截图路径\n                cc.log(jsb.fileUtils.getWritablePath());\n                var LogMgr = require(\"LogMgr\")\n                LogMgr.append(\"capture screen successfully!\\n\")\n                LogMgr.append(jsb.fileUtils.getWritablePath() + \"\\n\")\n\n                var view = cc.sceneNode.js.openView(\"prefabs/share/ShareView2\")\n            });\n        }\n    },\n\n    //处理审核\n    handleExamine: function () {\n        if (!IS_EXAMINE) {\n            return\n        }\n        this.find(\"btnShare\").active = false\n    },\n\n});\n"]}