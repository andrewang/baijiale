{"version":3,"sources":["../../../../../../../../assets/scripts/app/lobby/view/mall/assets/scripts/app/lobby/view/mall/MallView.js"],"names":["BaseView","require","http","cc","Class","extends","properties","diamondImages","default","type","SpriteFrame","onLoad","_super","i","find","js","getComponent","init","number","MallView","toggleDiamond","toggleRoomCard","diamondNode","roomCardNode","pay","eventMgr","addEvent","updateDiamondAndRoomCardNum","hide","handleExamine","string","gUserData","playerInfo","diamonds","room_card","onDestroy","removeEvent","getDiamondImages","requestDiamondList","t","sys","os","OS_ANDROID","flag","sendRequest","uid","ret","status","log","data_list","data","items","setData","bind","requestRoomCardList","show","param","Toggle","isChecked","showItems","IS_EXAMINE","active"],"mappings":"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","file":"MallView.js","sourceRoot":"../../../../../../../../assets/scripts/app/lobby/view/mall","sourcesContent":["var BaseView = require(\"BaseView\")\nvar http = require(\"Http\");\n\ncc.Class({\n    extends: BaseView,\n\n    properties: {\n        diamondImages: {\n            default: [],\n            type: [cc.SpriteFrame]\n        },\n    },\n\n    onLoad: function () {\n        this._super()\n        for (let i = 0; i < 6; i++) {\n            this[\"mallItemDiamond\" + i] = this.find(\"mallItemDiamond\" + i)\n            this[\"mallItemDiamond\" + i].js = this[\"mallItemDiamond\" + i].getComponent(\"MallItem\")\n            this[\"mallItemDiamond\" + i].js.onLoad()\n            this[\"mallItemDiamond\" + i].js.type = 1\n            this[\"mallItemDiamond\" + i].js.init({ number: i, MallView: this })\n        }\n\n        for (let i = 0; i < 6; i++) {\n            this[\"mallItemCard\" + i] = this.find(\"mallItemCard\" + i)\n            this[\"mallItemCard\" + i].js = this[\"mallItemCard\" + i].getComponent(\"MallItem\")\n            this[\"mallItemCard\" + i].js.onLoad()\n            this[\"mallItemCard\" + i].js.type = 2\n            this[\"mallItemCard\" + i].js.init({ number: i, MallView: this })\n        }\n\n        this.toggleDiamond = this.find(\"toggleDiamond\")\n        this.toggleRoomCard = this.find(\"toggleRoomCard\")\n        this.diamondNode = this.find(\"diamondNode\")\n        this.roomCardNode = this.find(\"roomCardNode\")\n        this.pay = this.find(\"payMainWindow\")\n        this.pay.js = this.pay.getComponent(\"MallPay\")\n        // this.testData()\n\n        cc.eventMgr.addEvent(\"updatePlayerInfoSuccess\", function () {\n            this.updateDiamondAndRoomCardNum()\n            this.pay.js.hide()\n            this.hide\n        }, this)\n\n        this.updateDiamondAndRoomCardNum()\n\n        this.handleExamine()\n    },\n\n    updateDiamondAndRoomCardNum: function () {\n        this.find(\"txtDiamondNum\").string = gUserData.playerInfo.diamonds\n        this.find(\"txtRoomCardNum\").string = gUserData.playerInfo.room_card\n    },\n\n    onDestroy: function () {\n        this._super()\n        cc.eventMgr.removeEvent(\"updatePlayerInfoSuccess\", this.hide)\n    },\n\n\n    // testData: function () {\n    //     let itemdata0 = { diamondNum: 3, presentDiamond: 0, rmb: 3 }\n    //     let itemdata1 = { diamondNum: 6, presentDiamond: 6, rmb: 6 }\n    //     let itemdata2 = { diamondNum: 12, presentDiamond: 12, rmb: 9 }\n    //     let itemdata3 = { diamondNum: 24, presentDiamond: 24, rmb: 12 }\n    //     let itemdata4 = { diamondNum: 48, presentDiamond: 48, rmb: 15 }\n    //     let itemdata5 = { diamondNum: 96, presentDiamond: 96, rmb: 128 }\n    //     var data_list = [itemdata0, itemdata1, itemdata2, itemdata3, itemdata4, itemdata5]\n    //     this.setMallItemData(data_list)\n    // },\n\n    getDiamondImages(number) {\n        return this.diamondImages[number]\n    },\n\n    requestDiamondList: function () {\n        var t = 1\n        if (cc.sys.os == cc.sys.OS_ANDROID) {\n            t = 2\n        }\n        var flag = 1\n        http.sendRequest(\"/game/diamond\", {uid : gUserData.uid, type : t, flag : flag}, function (ret, status) {\n            cc.log(\"shop\", ret)\n            // this.setMallItemData(ret.data.items)\n            var data_list = ret.data.items\n            for (let i in data_list) {\n                var data = data_list[i]\n                if (this[\"mallItemDiamond\" + i]) {\n                    this[\"mallItemDiamond\" + i].js.setData(data)\n                }\n            }\n        }.bind(this))\n    },\n\n    requestRoomCardList: function () {\n        var t = 1\n        if (cc.sys.os == cc.sys.OS_ANDROID) {\n            t = 2\n        }\n        var flag = 1\n        http.sendRequest(\"/game/exchange_menus\", {type : 1}, function (ret, status) {\n            cc.log(\"exchange_menus\", ret)\n            var data_list = ret.data\n            for (let i in data_list) {\n                var data = data_list[i]\n                if (this[\"mallItemCard\" + i]) {\n                    this[\"mallItemCard\" + i].js.setData(data)\n                }\n            }\n        }.bind(this))\n    },\n\n    show: function (param) {\n        this._super()\n        this.requestDiamondList()\n        this.requestRoomCardList()\n        this.toggleDiamond.getComponent(cc.Toggle).isChecked = false\n        this.toggleRoomCard.getComponent(cc.Toggle).isChecked = false\n        if (1 == param) {\n            this.toggleDiamond.getComponent(cc.Toggle).isChecked = true\n        }\n        else if (2 == param) {\n            this.toggleRoomCard.getComponent(cc.Toggle).isChecked = true\n        }\n        this.showItems()\n    },\n\n    handleExamine: function () {\n        if (!IS_EXAMINE) {\n            return\n        }\n        this.find(\"applePayNode\").active = false\n        this.find(\"treasurePayNode\").active = false\n    },\n\n    showItems: function () {\n        if (this.toggleDiamond.getComponent(cc.Toggle).isChecked) {\n            this.diamondNode.active = true\n            this.roomCardNode.active = false\n        }\n        else {\n            this.diamondNode.active = false\n            this.roomCardNode.active = true\n        }\n    },\n\n});\n"]}