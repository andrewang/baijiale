{"version":3,"sources":["../../../../../../assets/scripts/app/game/assets/scripts/app/game/PowerObj.js"],"names":["BaseObj","require","stateEnmu","cc","Class","extends","properties","onLoad","gameView","gameMgr","view","offset","touchNode","node","oldPos","clone","position","size","_contentSize","flagMovePowerObj","on","Node","EventType","TOUCH_START","touch","beginPos","parent","convertTouchToNodeSpaceAR","x","y","find","hideoveFirstTips","TOUCH_MOVE","_name","jipaiXianUid","_myData","user_base_info","uid","jipaiZhuangUid","pos","handleMovePowerObj","touchCb","backToMyself","player","getPlayerByUid","move","bind","TRANS_PERMI","gUserData","roomInfo","game_status","i","data","getBoundingBox","intersects","reqTransCardPermisssion","targ_uid","getUid","TOUCH_END","TOUCH_CANCEL","callback","stopAllActions","moveTo","cb","callFunc","seq","sequence","runAction","musicMgr","playEffect","flip","cb1","active","isOnPlayer","log","pos_quanxian_xian","pos_quanxian_zhuang","cb2","act1","scaleTo","act2","delayTime","typeMap","list","getCanMovePowerObjPlayers","length","showCanMovePowerObjAni","reset","setScale"],"mappings":"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","file":"PowerObj.js","sourceRoot":"../../../../../../assets/scripts/app/game","sourcesContent":["//挤牌权转移的对象\nvar BaseObj = require(\"BaseObj\")\nvar stateEnmu = require(\"GameConfig\").stateEnmu\ncc.Class({\n    extends: BaseObj,\n\n    properties: {\n\n    },\n\n    onLoad: function () {\n        var gameView = cc.gameMgr.view\n        var offset\n        var touchNode = this.node\n        var oldPos = clone(touchNode.position)\n        var size = touchNode._contentSize\n        this.flagMovePowerObj = true\n        touchNode.on(cc.Node.EventType.TOUCH_START, function (touch) {\n            var beginPos = touchNode.parent.convertTouchToNodeSpaceAR(touch)\n            offset = { x: beginPos.x - touchNode.position.x, y: beginPos.y - touchNode.position.y }\n            cc.gameMgr.view.find(\"player1\").hideoveFirstTips()\n        }, this);\n        touchNode.on(cc.Node.EventType.TOUCH_MOVE, function (touch) {\n            if ((\"node_quanxian_xian\" == this.node._name && cc.gameMgr.jipaiXianUid == cc.gameMgr._myData.user_base_info.uid) ||\n                (\"node_quanxian_zhuang\" == this.node._name && cc.gameMgr.jipaiZhuangUid == cc.gameMgr._myData.user_base_info.uid)) {\n                var pos = touchNode.parent.convertTouchToNodeSpaceAR(touch)\n                touchNode.position = { x: pos.x - offset.x, y: pos.y - offset.y }\n                this.handleMovePowerObj()\n            }\n        }, this)\n\n        var touchCb = function (touch) {\n            var backToMyself = function () {\n                var player\n                //拖动挤牌权在别的地方会自动回去原玩家身上\n                if (\"node_quanxian_xian\" == this.node._name && cc.gameMgr.jipaiXianUid) {\n                    player = cc.gameMgr.view.getPlayerByUid(cc.gameMgr.jipaiXianUid)\n                }\n                if (\"node_quanxian_zhuang\" == this.node._name && cc.gameMgr.jipaiZhuangUid) {\n                    player = cc.gameMgr.view.getPlayerByUid(cc.gameMgr.jipaiZhuangUid)\n                }\n                if (player) {\n                    this.move(player.node.position)\n                }\n            }.bind(this)\n            if (stateEnmu.TRANS_PERMI != gUserData.roomInfo.game_status) {\n                backToMyself()\n                // cc.common.showMsgBox({ type: 1, msg: \"不在转移阶段\" })\n                return\n            }\n            for (var i = 1; i <= 9; i++) {\n                var player = gameView.find(\"player\" + i)\n                if (player.data && player.node.getBoundingBox().intersects(this.node.getBoundingBox())) {\n                    this.move(player.node.position)\n                    cc.gameMgr.reqTransCardPermisssion({ targ_uid: player.getUid() })\n                    return\n                }\n            }\n            backToMyself()\n        }.bind(this)\n\n        touchNode.on(cc.Node.EventType.TOUCH_END, touchCb, this)\n        touchNode.on(cc.Node.EventType.TOUCH_CANCEL, touchCb, this)\n    },\n\n    move: function (pos, callback) {\n        this.node.stopAllActions()\n        var moveTo = cc.moveTo(0.1, pos)\n        var cb = cc.callFunc(function () {\n            if (callback) {\n                callback()\n            }\n        })\n        var seq = cc.sequence(moveTo, cb)\n        this.node.runAction(seq)\n        cc.musicMgr.playEffect(\"trans_power_obj.mp3\")\n    },\n\n    flip: function (cb) {\n        this.node.stopAllActions()\n        var cb1 = cc.callFunc(function () {\n            this.find(\"front\").node.active = false\n            this.find(\"back\").node.active = true\n        }.bind(this))\n        //判断挤牌权是否在玩家身上\n        var isOnPlayer = function () {\n            if (\"node_quanxian_xian\" == this.node._name) {\n                cc.log(\"xxxx\", this.node.position , cc.gameMgr.view.pos_quanxian_xian, this.node.position != cc.gameMgr.view.pos_quanxian_xian)\n                return !(this.node.position.x == cc.gameMgr.view.pos_quanxian_xian.x && this.node.position.y == cc.gameMgr.view.pos_quanxian_xian.y)\n            }\n            else  {\n                return !(this.node.position.x == cc.gameMgr.view.pos_quanxian_zhuang.x && this.node.position.y == cc.gameMgr.view.pos_quanxian_zhuang.y)\n            }\n        }.bind(this)\n        var cb2 = cc.callFunc(function () {\n            if (cb) {\n                cb()\n            }\n            if (isOnPlayer()) {\n                this.node.active = false\n            }\n        }.bind(this))\n        var act1 = cc.sequence(cc.scaleTo(0.4, 1, 0), cb1)\n        // var act2 = cc.sequence(cc.scaleTo(0.4, 1, 1), cb2)\n        var act2 = cc.scaleTo(0.4, 1, 1)\n        var seq = cc.sequence(act1, act2, cc.delayTime(1), cb2)\n        this.node.runAction(seq)\n    },\n\n    handleMovePowerObj: function () {\n        if (true == this.flagMovePowerObj && stateEnmu.TRANS_PERMI == gUserData.roomInfo.game_status) {\n            this.flagMovePowerObj = false\n            var typeMap = {\n                \"node_quanxian_zhuang\" : 1,\n                \"node_quanxian_xian\" : 2\n            }\n            var list = cc.gameMgr.view.getCanMovePowerObjPlayers(typeMap[this.node._name])\n            for (var i = 0; i < list.length; i++) {\n                var player = list[i]\n                player.showCanMovePowerObjAni()\n            }\n        }\n    },\n\n    reset: function () {\n        this.node.stopAllActions()\n        this.node.setScale(1)\n        this.node.active = true\n        this.find(\"front\").node.active = true\n        this.find(\"back\").node.active = false\n        this.flagMovePowerObj = true\n        if (\"node_quanxian_xian\" == this.node._name) {\n            this.node.position = cc.gameMgr.view.pos_quanxian_xian\n        }\n        if (\"node_quanxian_zhuang\" == this.node._name) {\n            this.node.position = cc.gameMgr.view.pos_quanxian_zhuang\n        }\n    }\n\n});\n"]}